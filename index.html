<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>杨晓龙</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="杨晓龙">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="杨晓龙">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="杨晓龙">
<meta name="twitter:description">
  
    <link rel="alternative" href="/atom.xml" title="杨晓龙" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="https://ss3.bdstatic.com/70cFv8Sh_Q1YnxGkpoWK1HF6hhy/it/u=4226557088,1275478253&amp;fm=116&amp;gp=0.jpg" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">杨晓龙</a></h1>
		</hgroup>

		
		<p class="header-subtitle">带着梦想去旅行，你会发现路上比终点更有意义</p>
		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						<div class="icon-wrap icon-link hide" data-idx="2">
							<div class="loopback_l"></div>
							<div class="loopback_r"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						<li>友情链接</li>
						
						
						<li>关于我</li>
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="/#" title="github">github</a>
					        
								<a class="weibo" target="_blank" href="/#" title="weibo">weibo</a>
					        
								<a class="rss" target="_blank" href="/#" title="rss">rss</a>
					        
								<a class="zhihu" target="_blank" href="/#" title="zhihu">zhihu</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/AFNetworking/" style="font-size: 10px;">AFNetworking</a> <a href="/tags/UIAlertController/" style="font-size: 10px;">UIAlertController</a> <a href="/tags/cocoaPods/" style="font-size: 10px;">cocoaPods</a> <a href="/tags/hexo教程/" style="font-size: 10px;">hexo教程</a>
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">奥巴马的博客</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">卡卡的美丽传说</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">本泽马的博客</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">吉格斯的博客</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">习大大大不同</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">托蒂的博客</a>
			        
			        </div>
				</section>
				

				
				
				<section class="switch-part switch-part4">
				
					<div id="js-aboutme">我是谁，我从哪里来，我到哪里去？我就是我，是颜色不一样的吃货…</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">杨晓龙</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img lazy-src="https://ss3.bdstatic.com/70cFv8Sh_Q1YnxGkpoWK1HF6hhy/it/u=4226557088,1275478253&amp;fm=116&amp;gp=0.jpg" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author">杨晓龙</h1>
			</hgroup>
			
			<p class="header-subtitle">带着梦想去旅行，你会发现路上比终点更有意义</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="/#" title="github">github</a>
			        
						<a class="weibo" target="_blank" href="/#" title="weibo">weibo</a>
			        
						<a class="rss" target="_blank" href="/#" title="rss">rss</a>
			        
						<a class="zhihu" target="_blank" href="/#" title="zhihu">zhihu</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap">
  
    <article id="post-深入了解UITableView" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/04/06/深入了解UITableView/" class="article-date">
  	<time datetime="2016-04-06T00:38:06.000Z" itemprop="datePublished">2016-04-06</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/04/06/深入了解UITableView/">深入了解UITableView</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>UITableView是工程开发中最经常使用到的UI控件，但是你真的了解它嘛，这里记录几点有用的但你可能并不知道的。<br>当我们的数据未能显示满一屏幕的时候，UITableView会显示多余的横线，这个时候你如果希望去掉这些横线，你可以加上这句话。</p>
<pre><code><span class="literal">self</span>.<span class="built_in">table</span>View.<span class="built_in">table</span>FooterView = [[UIView alloc]init];
</code></pre><p>UITableView的分割线默认是开头空15像素点的（好像是15来着～～），产品经理有时候希望能够定格显示，那么你可能会这么做。</p>
<pre><code><span class="keyword">self</span><span class="variable">.tableView</span><span class="variable">.separatorInset</span> = <span class="built_in">UIEdgeInsetsZero</span>;
</code></pre><p>但是你很快就会发现这么做并没有效果，这是因为separatorInset这个属性在iOS7以后就已经失效了，但是我们还是能够达到同样的效果，你可以在你的tablevView的代理协议实现界面加上下面这段代码：</p>
<pre><code><span class="tag">-</span>(void)<span class="tag">viewDidLayoutSubviews</span>
{
 <span class="tag">if</span> ([self.tableView <span class="attribute">respondsToSelector</span>:<span class="variable">@selector</span>(<span class="attribute">setSeparatorInset</span>:)]) {
  <span class="attr_selector">[self.tableView setSeparatorInset:UIEdgeInsetsMake(0,0,0,0)]</span>;
  }
 <span class="tag">if</span> ([self.tableView <span class="attribute">respondsToSelector</span>:<span class="variable">@selector</span>(<span class="attribute">setLayoutMargins</span>:)]) {
  <span class="attr_selector">[self.tableView setLayoutMargins:UIEdgeInsetsMake(0,0,0,0)]</span>;
  }
 }
<span class="tag">-</span>(void)<span class="tag">tableView</span>:(UITableView *)<span class="tag">tableView</span> <span class="tag">willDisplayCell</span>:(UITableViewCell *)<span class="tag">cell</span> <span class="tag">forRowAtIndexPath</span>:(NSIndexPath *)<span class="tag">indexPath</span>
{
 <span class="tag">if</span> ([cell <span class="attribute">respondsToSelector</span>:<span class="variable">@selector</span>(<span class="attribute">setSeparatorInset</span>:)]) {
  <span class="attr_selector">[cell setSeparatorInset:UIEdgeInsetsZero]</span>;
  }
  <span class="tag">if</span> ([cell <span class="attribute">respondsToSelector</span>:<span class="variable">@selector</span>(<span class="attribute">setLayoutMargins</span>:)]) {
  <span class="attr_selector">[cell setLayoutMargins:UIEdgeInsetsZero]</span>;
   }
  }
</code></pre><p>再次运行，好了我们的UITableView终于顶头显示分割线了。</p>
<p>很多情况下我们的UITableViewCell的高度是动态不确定的，比如说很多聊天的界面都需要我们去动态的计算cell的高度，你可能会在heightForRowAtIndexPath代理协议方法中返回你计算好的cell高度，然后在苹果推出约束以后，我们其实有更加方便的方法去实现相同的效果。你可以尝试在你的代码中加入以下两行代码：</p>
<pre><code><span class="literal">self</span>.<span class="built_in">table</span>View.estimatedRowHeight = <span class="number">68.0</span>;
<span class="literal">self</span>.<span class="built_in">table</span>View.rowHeight = UITableViewAutomaticDimension;
</code></pre><p>再次运行你的程序，其实你发现了好像你的cell并没有动态的返回高度，这是因为上面说了，这两行代码必须配合约束来使用。<br>我们拖出一个SB，然后在cell上放上一个label，讲label的numberOfLines属性设置为0，然后设置好label的上下左右约束，然后再对label的内容进行赋值，再次运行你的程序，这个时候你的cell就会动态的显示高度了，label的高度取决于你的内容的多少，同时按照你的约束进行显示。</p>
<p>-你可能写过这样下面这样的代码</p>
<pre><code>-(<span class="typename">void</span>)<span class="string">tableView:</span>(UITableView *)tableView <span class="string">didSelectRowAtIndexPath:</span>(NSIndexPath *)indexPath{
[tableView <span class="string">deselectRowAtIndexPath:</span>indexPath <span class="string">animated:</span><span class="literal">true</span>];
[tableView beginUpdates];
 ROW--;<span class="comment">//此操作表示减少数据源的个数。</span>
 [tableView <span class="string">deleteRowsAtIndexPaths:</span>@[indexPath] <span class="string">withRowAnimation:</span>UITableViewRowAnimationRight];
 [tableView endUpdates];
 }
</code></pre><p>用一个动画来删除某一个cell,其中有两行代码特别有意思：</p>
<pre><code><span class="title">[tableView beginUpdates]</span><span class="comment">;</span>
<span class="title">[tableView endUpdates]</span><span class="comment">;</span>
</code></pre><p>这俩吧其实和[tableView reloadData]作用类似，但是这俩货却能非常轻松的创造出不错的效果，比如说和我们上一点说的用约束来控制label的行高相结合的是的时候，我们先来看一下效果:<br><img src="http://jbcdn2.b0.upaiyun.com/2016/03/11b5fc6749c7ba37d05b8d13550433ad.gif" alt=""><br>一个tableView点击缩放的效果<br>其实我的代码很少，核心代码只有以下几行：</p>
<pre><code>-(<span class="typename">void</span>)<span class="string">tableView:</span>(UITableView *)tableView <span class="string">didSelectRowAtIndexPath:</span>(NSIndexPath *)indexPath{
[tableView <span class="string">deselectRowAtIndexPath:</span>indexPath <span class="string">animated:</span><span class="literal">true</span>];
UITableViewCell *cell = [tableView <span class="string">cellForRowAtIndexPath:</span>indexPath];
UILabel *label = [cell.contentView <span class="string">viewWithTag:</span><span class="number">1000</span>];
[tableView beginUpdates];
<span class="keyword">if</span> (label.numberOfLines == <span class="number">0</span>) {
    label.numberOfLines = <span class="number">1</span>;
}<span class="keyword">else</span>{
    label.numberOfLines = <span class="number">0</span>;
}
[tableView endUpdates];
}
</code></pre><p>然后在他的点击动作中改变label的numberOfLines，同时结合使用：</p>
<pre><code><span class="title">[tableView beginUpdates]</span><span class="comment">;</span>
<span class="title">[tableView endUpdates]</span><span class="comment">;</span>
</code></pre><p>像上面po出来的代码那样，这个时候你如果使用[tableView reloadData]也能够达到改变cell高度的效果，但是界面上就不会有使用[tableView beginUpdates]那么流畅,以此类推，其实在很多地方都可以用[tableView beginUpdates]来代替[tableView reloadData]来达到更好的效果.</p>
<p>你可能会经常忽略UITableView的一些属性和回调，必须下面这个方法:</p>
<pre><code>-(<span class="keyword">void</span>)tableView:(<span class="built_in">UITableView</span> *)tableView willDisplayCell:(<span class="built_in">UITableViewCell</span> *)cell forRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath{
<span class="built_in">CGFloat</span> offSet = tableView<span class="variable">.contentOffset</span><span class="variable">.y</span>;
<span class="keyword">if</span> (offSet&lt;=<span class="number">0</span>) {
  <span class="keyword">return</span>;
  }
<span class="built_in">CGRect</span> oldRect = cell<span class="variable">.frame</span>;
<span class="built_in">CGRect</span> newRect = cell<span class="variable">.frame</span>;
newRect<span class="variable">.origin</span><span class="variable">.x</span> += <span class="number">50</span>;
cell<span class="variable">.frame</span> = newRect;
[<span class="built_in">UIView</span> animateWithDuration:<span class="number">0.5</span> animations:^{
  cell<span class="variable">.frame</span> = oldRect;
  }];
  }
</code></pre><p>如果你这么写会简单的有一个展示的动画，这个回调就是在cell展示到屏幕的时候发起的动作。<br>还有这个属性：tableView.visibleCells，你的产品经理可能会要求你的cell在滚动的时候进行一些展示类的动画—-滚动的时候进行展开收起之类的，这样的话你可以这么做：</p>
<pre><code>-(void)scrollViewDidScroll:(UIScrollView <span class="keyword">*</span>)scrollView{
for (UITableViewCell <span class="keyword">*</span>cell in _tableView.visibleCells) {
  /<span class="keyword">*</span><span class="keyword">*</span>
   <span class="keyword">*</span>  你可以在这里对当前的cell进行一些操作
   <span class="keyword">*</span>
   <span class="keyword">*</span>/
   }
 }
</code></pre><p>这个属性会返回即将展示到屏幕上的cell，而放在这个滚动的回掉中你就可以对你的cell进行不停的调整了，具体能做出什么动画，就靠你的想象能力了。<br>tableView可能会造成你的Controller过于庞大，或许你可以使用MVVM类似的构架来瘦身你的Controller。。。。。。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-重写方法支持右滑返回" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/04/05/重写方法支持右滑返回/" class="article-date">
  	<time datetime="2016-04-05T01:34:01.000Z" itemprop="datePublished">2016-04-05</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/04/05/重写方法支持右滑返回/">重写方法支持右滑返回</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>将UIGestureRecognizerDelegate放在公共导航类YXLNavigationController里遵守，并设置代理为导航类，但是，只遵守-gestureRecognizerShouldBegin:代理方法。</p>
<pre><code><span class="class"><span class="keyword">@interface</span> <span class="title">YXLNavigationController</span> () &lt;<span class="title">UIGestureRecognizerDelegate</span>&gt;</span>

<span class="keyword">@end</span>

<span class="class"><span class="keyword">@implementation</span> <span class="title">YXLNavigationController</span></span>


- (<span class="keyword">void</span>)viewDidLoad {
[<span class="keyword">super</span> viewDidLoad];
<span class="keyword">self</span><span class="variable">.interactivePopGestureRecognizer</span><span class="variable">.delegate</span> = <span class="keyword">self</span>;
}

- (<span class="built_in">BOOL</span>)gestureRecognizerShouldBegin:(<span class="built_in">UIGestureRecognizer</span> *)gestureRecognizer {
  <span class="built_in">BOOL</span> ok = <span class="literal">YES</span>; <span class="comment">// 默认为支持右滑反回</span>
 <span class="keyword">if</span> ([<span class="keyword">self</span><span class="variable">.topViewController</span> isKindOfClass:[YXLBaseViewController class]]) {
<span class="keyword">if</span> ([<span class="keyword">self</span><span class="variable">.topViewController</span> respondsToSelector:<span class="keyword">@selector</span>(gestureRecognizerShouldBegin)]) {
  YXLBaseViewController *vc = (YXLBaseViewController *)<span class="keyword">self</span><span class="variable">.topViewController</span>;
 ok = [vc gestureRecognizerShouldBegin];
  }
 }
<span class="keyword">return</span> ok;
}

<span class="keyword">@end</span>
</code></pre>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-UITableView的平滑滚动" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/04/01/UITableView的平滑滚动/" class="article-date">
  	<time datetime="2016-04-01T15:49:53.000Z" itemprop="datePublished">2016-04-01</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/04/01/UITableView的平滑滚动/">UITableView的完美平滑滚动</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>闲话少叙，直接来干货<br>第一点是即使要显示更多内容，也要重用 cell/header/footer 的单个实例（single instance）。这是优化 UIScrollView（UITableView 的父类）最显著的方式，苹果工程师已在回收机制上做了处理。正确的做法是，你应该持有唯一的 cell/header/footer 类，且只初始化了一次，并返回给 UITableView 来重用该对象。</p>
<p>我觉得在这里没必要做详细的回顾，因为重用 cell 的工作流程在文档有详细描述。</p>
<p>但有一点需要重视：需要在 UITableView 的数据源中实现 tableView:cellForRowAtIndexPath: 方法，在方法中调用每个 cell 并应尽可能让方法快速运行。所以你必须尽可能迅速地返回重用的 cell 对象。</p>
<p>在该方法中，不要进行数据绑定（perform data binding），因为在当前在界面上还没有 cell。为此，你可以在 UITableView 的委托（代理）中使用 tableView:willDisplayCell:forRowAtIndexPath: 方法，该方法会在 UITableView 的 bounds 里显示 cell 之前被准确调用。</p>
<p>第二点不是很难理解，但有一件事需要说明。</p>
<p>该工具只用于设置 UITableView 的固定行高是没意义的，但如果你的上下文出于某种原因需要动态设置 cell 的高度，那么你可能很容易得到起伏不定的滚动。</p>
<p>我们知道，UITableView 只是 UIScrollView 的子类，可以让用户在比可视范围更大的区域内进行交互。任何 UIScrollView 对象通过诸如 contentSize、contentOffset 等东西来显示符合要求的矩形给用户。</p>
<p>但 UITableView 哪里出问题了？正如前面讲到的，UITableView 不会同时保留所有的 cell。相反，它仅仅显示必要的 cell 给用户。</p>
<p>那么，UITableView 是如何得知它的 contentSize 的呢？它仅仅是计算了所有 cell 的高度总和。</p>
<p>UITableView 的 tableView: heightForRowAtIndexPath:委托方法会为每个 cell（即使它不显示）调用一次，所以你应当非常迅速返回当前 cell 的高度。</p>
<p>大多数人会犯巨大的错误，通过通过边界（bound）数据布局初始化过的 cell，并取得它们高度。如果你想提高滚动性能，那么就不该用这种方式去计算 cell 的高度，因为这样会造成一切的东西都极其的慢，60 FPS 是 iOS 的显示标准，这样做就会下降到 15~20，并且你的滚动操作会变得迟缓、卡顿。</p>
<p>如果我们没有 cell 对象，如何计算进一步的 cell 的高度呢？下面是 cell 代码的一个例子，它利用类方法，基于传递的宽度和显示数据（cell 的连接器）来返回高度：<br><img src="http://ww1.sinaimg.cn/mw690/6941baebgw1f2dtex3kmkj20xc0upn94.jpg" alt=""><br>它是使用这种方式返回值给 UITableViews 的：<br><img src="http://ww4.sinaimg.cn/mw690/6941baebgw1f2dtexoytuj20xc02dt9z.jpg" alt=""><br>在实现所有这些代码的过程中，你获得了多少乐趣？你们大多数会说一丢丢都没有啊。但我没说这是易事啊。当然，我们可以建立自己的类来进行手动布局和高度计算，但有时候，我们并没有足够的时间。你可以从在 Telegram 网站的 iOS 应用代码中找案例去实现它。</p>
<p>从 iOS8 开始，我们可以使用自动高度计算，而无需实现上面提到的 UITableViews 的委托方法。要做到这一点，你可以使用 AutoLayout 工具，并把 行高 设置为 UITableViewAutomaticDimension。更多的详细信息可以在 StackOverflow 网站上找到，上面有很好的解释。</p>
<p>尽管可以使用这些工具，但我还是强烈建议你不要这么做。另外，我建议不要使用更复杂的数学运算来确定 cell 的高度，而尽可能仅仅使用加、减、乘、除。</p>
<p>那 AutoLayout 呢？难道真如我所那么慢？也许你会感到惊讶，但这的确是事实。如果你的应用运行在所有的生命周期长的真实设备（特别是相对于安卓设备），想看到完美的平滑滚动，那么结果会是慢得令人难以置信的。而且你拥有越多的子视图，你的 AutoLayout 就运行得越慢。</p>
<p>AutoLayout 相对低性能的原因是在 Cassowary 布局引擎下处理的。你需要要处理的的子视图布局约束越多，你花费在返回 cell 给 UITableViews 的时间就越多。</p>
<p>什么是速度更快：执行一些数值较小的基本数学运算，或者处理大量的线性等式、不等式？现在想象一下，用户希望很快速滚动，然后每个 cell 的 AutoLayout 执行所有这些疯狂的计算。</p>
<p>使用内置工具优化 UITableViews 的正确方式：</p>
<p>重用 cell 对象：对于特定的 cell 类型，你应该只初始化一次<br>不要在 cellForRowAtIndexPath: 方法绑定数据，因为这时 cell 还没显示，而是使用 UITableViews 的委托方法 tableView:willDisplayCell:forRowAtIndexPath:。<br>进一步计算 cell 的高度要迅速。虽然这是工程师的日常事务，但是要想平滑滚动复杂的 cell，你要多点耐心。<br>我们探讨更深入的问题</p>
<p>上面提及的几点还不足以实现真正的平滑滚动，而且尤其当你需要实现复杂的 cell，有着许多梯度渐变、视图、交互元素、装饰元素等更多的内容时，其滚动效果更为突出。</p>
<p>此时，我们即使完成了上述的需求，也很容易造成 UITableViews 的卡顿。你给 UITableViewCell 添加的视图越多，其滚动时的 FPS 下降的幅度就越大。现在有了手工布局和高度计算优化，但现在问题不在于布局，而是渲染。</p>
<p>让我们把注意力转移到 UIView 的一个叫 “opaque” 的属性上。文档中写道，它有助于绘图系统，以确定 UIView 是否为透明。如果不是，绘图系统在呈现该视图时会做一些优化并提高性能。</p>
<p>我们所需的性能，会不会是它呢？用户可能很密集地滚动表格，例如使用 scrollsToTop 功能，且用户不一定有最新的 iPhone，因此 cell 必须要非常快地渲染。比“正常”的视图还要快。</p>
<p>最慢的一种渲染方式是混合。它在设备的 GPU 支持下执行，这种硬件正是为了混合渲染（不仅仅混合渲染）开发而产生的。</p>
<p>正如你可能已经猜到，提高性能的方法是减少混合操作。但在减少一些东西之前，你该找到它。我们来试试。</p>
<p>在 iOS 模拟器运行你的应用，点击“Debug”菜单，然后选择“Color Blended Layers”选项。这时 iOS 模拟器会将所有区域的显示划分成两种颜色：绿色和红色。</p>
<p>绿色区域是没有混合渲染的，红色区域是经过有混合渲染的。<br><img src="http://ww2.sinaimg.cn/mw690/6941baebgw1f2dto8ya5bj20dw0opq6q.jpg" alt=""><br>如你所见，在 cell 里有至少两个区域是经过混合渲染的，但你可能没有看到之间有什么不同（而且这种混合渲染是多余的！）。</p>
<p>每次遇到这样的情况，你都应当仔细研究，并在不同的情况下，使用不同的方式来避免混合渲染。在我的这种情况下，将 背景色 设置不透明就已经实现目标了。</p>
<p>但有时候我们会遇到更复杂的事情。看这里：我们有一个梯度渐变，但混合是不存在的。<br><img src="http://ww2.sinaimg.cn/mw690/6941baebgw1f2dto346dyj20go0tmaf1.jpg" alt=""><br>如果你想使用 CAGradientLayer 来实现这个效果，你会失望的，因为在 iPhone 6 其 FPS 会下降到 25~30，并且无法达到快速滚动。</p>
<p>它毕竟是会发生的，因为我们已经将两个不同图层的内容混合了，分别是 UILabel 的 CATextLayer 和我们构想的 CAGradientLayer。</p>
<p>当正确使用 CPU 和 GPU 资源，它们是负载均衡的，FPS 保持约为 60。如下所示：<br><img src="http://ww3.sinaimg.cn/mw690/6941baebgw1f2dtnzubiwj20m706eaai.jpg" alt=""><br>当设备需要显示执行大量的混合操作时问题就会出现，GPU 将会满载，但 CPU 却会保持低负荷运行。</p>
<p>在2010的夏末，恰好是 iPhone 4 发布后，许多工程师都面临着这个问题。然后苹果推出了革命性的视网膜屏，但搭配相当普通的 GPU。然而，它却还有足够的能力去支持显示，但上述问题就出现得更频繁了。</p>
<p>这个决定的结果就是，你可以看到目前在 iOS 7 下的 iPhone 4 上的所有应用甚至是最简单的应用的操作都变得卡顿。无论如何，通过本文的所有建议，你将能够让你的应用即使在这种情况下都可以达到 60 FPS，尽管其过程有些难度。</p>
<p>那么那是做什么用的呢？事实上，解决方法就在这里：用 CPU 来渲染！去载 GPU，让它只在必须用 GPU 的地方执行混合渲染。例如，由 CALayers 执行动画的地方。</p>
<p>我们可以通过在 UIView 的 drawRect: 方法中使用 CoreGraphics 操作，如：<br><img src="http://ww2.sinaimg.cn/mw690/6941baebgw1f2dtnz8l9bj20xc0yttjz.jpg" alt=""><br>这些代码就很好？即使是我，也会说不是真的。另外这种方式是撤销所有在 UIView 上的缓存优化（在任何情况下，它们都是不必要的）。但正是这种做法将禁用一些混合操作，不加载 GPU 并能让 UITableViews 更流畅。</p>
<p>但要注意：使用这种方式增加渲染性能不是因为 CPU 比 GPU 快！而是因为 CPU 在多数情况下都不会 100% 满载，这种方式能让我们通过负载 CPU 来实现在一些渲染任务中去载 GPU。</p>
<p>优化混合操作的关键是平衡 CPU 和 GPU 的负载。</p>
<p>简单总结一下优化在 UITableViews 中绘制数据的操作：</p>
<p>减少 iOS 没必要的混合渲染区域：通过 iOS 模拟器和 Instruments 工具对应用进行检查，不使用透明背景；如果可以的话，不渲染梯度渐变，其效果会更好。<br>优化代码，实现 CPU 和 GPU 负载均衡。你应清晰了解哪一部分的渲染必须通过 GPU 来完成，哪一部分的渲染可以通过 CPU 来保持均衡。<br>根据不同类型 cell 写不同的代码。<br>像素探索</p>
<p>你知道像素长什么样的吗？我指的是，屏幕中的物理像素。我相信你知道的，但我还是要告诉你：<br><img src="http://ww2.sinaimg.cn/mw690/6941baebgw1f2dtnxrqo5j20ge08cq4m.jpg" alt=""><br>不同的屏幕有不同的制作工艺，但这其中都有共同之处。实际上，每个物理像素是通过红、绿、蓝三种颜色子像素组成的。</p>
<p>这就造成了每个像素并不是原子单元的，尽管在应用中看起来是这样。<br>直到搭配视网膜屏的 iPhone 4 出现，物理像素可以被描述为整形坐标。因为视网膜显示屏是多倍于屏幕点，而不是 Cocoa Touch 环境中的像素，而且他们可以为浮点数。</p>
<p>在完美（我们试图构建的）世界，屏幕点总是被处理成物理像素的整数坐标。但在现实生活中，它可能是浮点数值，例如，直线可能开始于横坐标的 0.25 处。并从这时，iOS 将对子像素进行着色。</p>
<p>当这种技术运用于特定类型的内容（如文本）确实比较合理。但如果我们只是绘制设计的平滑直线时就没必要使用这种技术。</p>
<p>如果你的所有的平滑直线都进行子像素渲染（这将是不可见的，因为你的直线只是设计成平滑的），那么你会让 iOS 做无用功，同时也降低了 FPS。</p>
<p>如何获得与不必要的子像素抗锯齿的问题？最经常发生的情况是在需要代码计算的视图中，其坐标系数值变成了浮点数值或者使用不适合的图片素材，图片尺寸不对齐屏幕的物理像素（例如，你有一张 60×61 而不是 60×60 的图片给视网膜屏显示）</p>
<p>就如前面内容提到的，在减少一些东西前，我们应去找到它。在 iOS 模拟器运行你的应用，并点选“Debug”菜单的“Color Misaligned Images”选项。</p>
<p>这次，模拟器上有两大高亮的区域：紫红色区域执行了子像素渲染，黄色区域渲染的图片尺寸没有对齐到它们所在的区域。<br><img src="http://ww4.sinaimg.cn/mw690/6941baebgw1f2dtnwzmouj20go0tm78k.jpg" alt=""><br><img src="http://ww4.sinaimg.cn/mw690/6941baebgw1f2dtnvzbt2j20go0tmn17.jpg" alt=""><br>如何在你的代码中找到发生问题的地方？我总是使用部分自定义绘制进行手工布局的，所以对我来说没问题。如果你是使用 Interface Builder，那么我只能同情你了。</p>
<p>一般情况下，解决这个问题只需要简单使用下 ceilf、floorf 和 CGRectIntegral 来凑整你的坐标系即可。</p>
<p>通过探索的结果，我有以下几点建议：</p>
<p>凑整所有像素相关的数据：UIView 的点坐标、宽高和其他数据。<br>追踪你的图像资源：图片必须是像素完美的，否则当它们在视网膜屏上渲染时，它会做一些无必要的抗锯齿处理。<br>定期检查你的环境和上述的问题，因为它可以很快修正。<br>异步 UI</p>
<p>可能这看起来有点奇怪，但如果你知道自己在做什么，那么这是让 UITableViews 更平滑滚动的很有效的办法。</p>
<p>现在我们将讨论一些你应该做和可能要做的事情。</p>
<p>每个中等以上级别的应用都有必要使用带自定义多媒体内容的 cell，如：文本、图片、动画，甚至有时是视频。</p>
<p>而所有这些东西都被修饰：头像是圆的、文字带话题标签、用户名等。</p>
<p>我们注意到，对于需要尽快返回的 cell，在这点上我们有些麻烦： clipsToBounds 慢，图片从网络加载，字符串要关联话题标签等其他一些麻烦。</p>
<p>优化似乎是这样的：你应执行这些操作，但如果你执行在主线程，那么它不会让你快速返回 cell。</p>
<p>后台加载图片并处理圆角，然后将处理过的图片赋值给 UIImageView。</p>
<p>一次显示所有文本，但在后台关联话题标签，然后刷新带样式的文本。</p>
<p>具体的操作取决于你的 cell 的具体内容，但主要的想法是让它在后台运行大量的操作。这些操作不仅是网络相关代码并且使用 Instruments 工具来找出所在需要在代码运行的操作。</p>
<p>记得尽量迅速返回 cell。</p>
<p>有时候，我们即使用尽了上面所有的技术都无补于事。GPU 仍然不奏效（iPhone 4 + iOS 7），cell 中有大量内容，我们将要通过 CALayers 来实现动画，因为它真的很难通过 drawRect: 方法实现效果。</p>
<p>在这种情况下，我们应该在后台渲染其他的一切。除此之外，当用户快速滚动 UITableViews 时，它对提高 FPS 非常有效。</p>
<p>你比如说 Facebook 应用，它做的正是这一点。为了检测这一点，你可以充分往下滚动，然后点击状态栏。列表马上就滚动起来，这样你就可以清楚看到，cell 不会在此时渲染。如果要说的更精确下，cell 还不能及时获得。</p>
<p>你可以自己做一遍因为它足够简单。为此，你应该设置 CALayers 的 drawsAsynchronously 为 YES。</p>
<p>但是，我们可以检查此操作的必要性。在 iOS 模拟器运行应用，选择“Debug”菜单的“Color Offscreen-Rendered”选项。现在所有在后台渲染的区域会以黄色突出显示。<br><img src="http://ww3.sinaimg.cn/mw690/6941baebgw1f2dtnudb8zj20go0tmaed.jpg" alt=""><br><img src="http://ww4.sinaimg.cn/mw690/6941baebgw1f2dtntnqklj20go0tmn1j.jpg" alt=""><br>如果对一些层启用该模式，但它并没有高亮突出显示，那么这个地方是还不够慢。</p>
<p>为了找到 CALayers 的瓶颈并进一步缩小它，你可以使用 XCode Instruments 的 Time Profiler 工具。</p>
<p>下面是实现异步 UI 的操作列表：</p>
<p>找到那个不能让你快速返回 cell 的渲染瓶颈。<br>将操作移至后台并更新在主线程的显示内容。<br>最后一招是设置你的 CALayers 为异步显示模式（即使它们简单的文本或图片），者将帮助你提高 FPS。​<br>总结</p>
<p>我试图解释 iOS 绘图系统的主要观点（不使用 OpenGL，因为它更少情况下才使用的）。当然，这其中的一些似乎模糊了，但实际最合适的方向是：研究你的代码，找到所有影响滚动性能的问题。</p>
<p>在不同的情况，可以用不同的方式进行优化，但原则是永远不会变的。</p>
<p>实现完美的平滑滚动的关键是非常特殊的代码，它允许你使用 iOS 设备所有的力量让应用变得真正的流畅。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-AsyncSocket" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/04/01/AsyncSocket/" class="article-date">
  	<time datetime="2016-04-01T07:50:46.000Z" itemprop="datePublished">2016-04-01</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/04/01/AsyncSocket/">AsyncSocket</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>原    iOS学习之Socket使用简明教程－ AsyncSocket</p>
<p>如果需要在项目中像QQ微信一样做到即时通讯，必须使用socket通讯，本人也是刚学习，分享一下，有什么不对的地方希望大家指正</p>
<p>ios原生的socket用起来不是很直观，所以我用的是AsyncSocket这个第三方库，对socket的封装比较好，只是好像没有带外传输（out—of-band） 如果你的服务器需要发送带外数据，可能得想下别的办法</p>
<p>环境</p>
<p><a href="https://github.com/robbiehanson/CocoaAsyncSocket" target="_blank" rel="external">下载AsyncSocket</a>类库，将RunLoop文件夹下的AsyncSocket.h, AsyncSocket.m, AsyncUdpSocket.h, AsyncUdpSocket.m 文件拷贝到自己的project中</p>
<p>添加CFNetwork.framework, 在使用socket的文件头</p>
<pre><code><span class="id">#import</span> &lt;sys/socket.h&gt;
<span class="id">#import</span> &lt;netinet/<span class="keyword">in</span>.h&gt;
<span class="id">#import</span> &lt;arpa/inet.h&gt;
<span class="id">#import</span> &lt;unistd.h&gt;
</code></pre><p>使用</p>
<ol>
<li>socket 连接</li>
</ol>
<p>即时通讯最大的特点就是实时性，基本感觉不到延时或是掉线，所以必须对socket的连接进行监视与检测，在断线时进行重新连接，如果用户退出登录，要将socket手动关闭，否则对服务器会造成一定的负荷。</p>
<p>一般来说，一个用户（对于ios来说也就是我们的项目中）只能有一个正在连接的socket，所以这个socket变量必须是全局的，这里可以考虑使用单例或是AppDelegate进行数据共享，本文使用单例。如果对一个已经连接的socket对象再次进行连接操作，会抛出异常（不可对已经连接的socket进行连接）程序崩溃，所以在连接socket之前要对socket对象的连接状态进行判断</p>
<p>使用socket进行即时通讯还有一个必须的操作，即对服务器发送心跳包，每隔一段时间对服务器发送长连接指令（指令不唯一，由服务器端指定，包括使用socket发送消息，发送的数据和格式都是由服务器指定），如果没有收到服务器的返回消息，AsyncSocket会得到失去连接的消息，我们可以在失去连接的回调方法里进行重新连接。</p>
<p>先创建一个单例，命名为Singleton</p>
<p>Singleton.h</p>
<p>// Singleton.h</p>
<p>#import “AsyncSocket.h”</p>
<p>#define DEFINE_SHARED_INSTANCE_USING_BLOCK(block) \<br>    static dispatch_once_t onceToken = 0; \<br>    __strong static id sharedInstance = nil; \<br>    dispatch_once(&amp;onceToken, ^{ \<br>    sharedInstance = block(); \<br>    }); \<br>    return sharedInstance; \</p>
<pre><code><span class="constant">@interface</span> <span class="built_in">Singleton</span> : NSObject

+ (<span class="built_in">Singleton</span> *)sharedInstance<span class="comment">;</span>

<span class="constant">@end</span>
<span class="built_in">Singleton</span>.m

+(<span class="built_in">Singleton</span> *) sharedInstance
{

<span class="keyword">static</span> <span class="built_in">Singleton</span> *sharedInstace = nil<span class="comment">;</span>
<span class="keyword">static</span> dispatch_once_t onceToken<span class="comment">;</span>
dispatch_once(&amp;onceToken, ^{

sharedInstace = [[self alloc] init]<span class="comment">;</span>
})<span class="comment">;</span>

<span class="keyword">return</span> sharedInstace<span class="comment">;</span>
}
</code></pre><p>这样一个单例就创建好了</p>
<p>在.h文件中生命socket变量</p>
<pre><code><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) AsyncSocket    *socket;       <span class="comment">// socket</span>
<span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>  ) <span class="built_in">NSString</span>       *socketHost;   <span class="comment">// socket的Host</span>
<span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">UInt16</span>         socketPort;    <span class="comment">// socket的prot</span>
</code></pre><p>下面是连接，心跳，失去连接后重连</p>
<p>连接(长连接)</p>
<p>在.h文件中声明方法，并声明代理<asyncsocketdelegate></asyncsocketdelegate></p>
<pre><code>-(<span class="keyword">void</span>)socketConnectHost;<span class="comment">// socket连接</span>
</code></pre><p>在.m中实现，连接时host与port都是由服务器指定，如果不是自己写的服务器，请与服务器端开发人员交流</p>
<p>// socket连接</p>
<pre><code>-(void)socketConnectHost{
<span class="variable">self</span>.socket    = [[AsyncSocket alloc] initWithDelegate:<span class="variable">self</span>];

NSError *<span class="built_in">error</span> = nil;

[<span class="variable">self</span>.socket connectToHost:<span class="variable">self</span>.socketHost onPort:<span class="variable">self</span>.socketPort withTimeout:<span class="number">3</span> <span class="built_in">error</span>:&amp;<span class="built_in">error</span>];

}
</code></pre><p>心跳</p>
<p>心跳通过计时器来实现 在singleton.h中声明一个定时器</p>
<pre><code><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, retain) <span class="built_in">NSTimer</span>        *connectTimer; <span class="comment">// 计时器</span>
</code></pre><p>在.m中实现连接成功回调方法，并在此方法中初始化定时器，发送心跳在后文向服务器发送数据时说明</p>
<p>#pragma mark  - 连接成功回调<br>    -(void)onSocket:(AsyncSocket <em>)sock didConnectToHost:(NSString  </em>)host port:(UInt16)port<br>    {<br>    NSLog(@”socket连接成功”);</p>
<pre><code><span class="comment">// 每隔30s像服务器发送心跳包</span>
<span class="keyword">self</span><span class="variable">.connectTimer</span> = [<span class="built_in">NSTimer</span> scheduledTimerWithTimeInterval:<span class="number">30</span> target:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(longConnectToSocket) userInfo:<span class="literal">nil</span> repeats:<span class="literal">YES</span>];<span class="comment">// 在longConnectToSocket方法中进行长连接需要向服务器发送的讯息</span>

[<span class="keyword">self</span><span class="variable">.connectTimer</span> fire];

}
</code></pre><ol>
<li>socket 断开连接与重连</li>
</ol>
<p>断开连接</p>
<p>失去连接有几种情况，服务器断开，用户主动cut，还可能有如QQ其他设备登录被掉线的情况，不管那种情况，我们都能收到socket回调方法返回给我们的讯息，如果是用户退出登录或是程序退出而需要手动cut，我们在cut前对socket的userData赋予一个值来标记为用户退出，这样我们可以在收到断开信息时判断究竟是什么原因导致的掉线</p>
<p>在.h文件中声明一个枚举类型</p>
<pre><code><span class="class"><span class="keyword">enum</span>{</span>
<span class="constant">SocketOfflineByServer</span>,<span class="regexp">//</span> 服务器掉线，默认为<span class="number">0</span>
<span class="constant">SocketOfflineByUser</span>,  <span class="regexp">//</span> 用户主动cut
};
</code></pre><p>声明断开连接方法</p>
<pre><code>-(<span class="keyword">void</span>)cutOffSocket; <span class="comment">// 断开socket连接</span>
</code></pre><p>.m</p>
<p>// 切断socket</p>
<pre><code>-(<span class="literal">void</span>)cutOffSocket{

<span class="built_in">self</span><span class="built_in">.</span>socket<span class="built_in">.</span>userData = SocketOfflineByUser;<span class="comment">// 声明是由用户主动切断</span>

<span class="preprocessor">[</span><span class="built_in">self</span><span class="built_in">.</span>connectTimer invalidate<span class="preprocessor">]</span><span class="markup">;

</span><span class="preprocessor">[</span><span class="built_in">self</span><span class="built_in">.</span>socket disconnect<span class="preprocessor">]</span><span class="markup">;
}</span>
</code></pre><p>重连</p>
<p>实现代理方法</p>
<pre><code>-(<span class="keyword">void</span>)onSocketDidDisconnect:(AsyncSocket *)sock
{
<span class="built_in">NSLog</span>(<span class="string">@"sorry the connect is failure %ld"</span>,sock<span class="variable">.userData</span>);
<span class="keyword">if</span> (sock<span class="variable">.userData</span> == SocketOfflineByServer) {
    <span class="comment">// 服务器掉线，重连</span>
    [<span class="keyword">self</span> socketConnectHost];
}
<span class="keyword">else</span> <span class="keyword">if</span> (sock<span class="variable">.userData</span> == SocketOfflineByUser) {
    <span class="comment">// 如果由用户断开，不进行重连</span>
    <span class="keyword">return</span>;
}

}
</code></pre><ol>
<li>socket 发送与接收数据</li>
</ol>
<p>发送数据<br>我们补充上文心跳连接未完成的方法</p>
<p>// 心跳连接</p>
<pre><code>-(<span class="typename">void</span>)longConnectToSocket{

<span class="comment">// 根据服务器要求发送固定格式的数据，假设为指令@"longConnect"，但是一般不会是这么简单的指令</span>

NSString *longConnect = @<span class="string">"longConnect"</span>;

NSData   *dataStream  = [longConnect <span class="string">dataUsingEncoding:</span>NSUTF8StringEncoding];

[self.socket <span class="string">writeData:</span>dataStream <span class="string">withTimeout:</span><span class="number">1</span> <span class="string">tag:</span><span class="number">1</span>];

}
</code></pre><p>socket发送数据是以栈的形式存放，所有数据放在一个栈中，存取时会出现粘包的现象，所以很多时候服务器在收发数据时是以先发送内容字节长度，再发送内容的形式，得到数据时也是先得到一个长度，再根据这个长度在栈中读取这个长度的字节流，如果是这种情况，发送数据时只需在发送内容前发送一个长度，发送方法与发送内容一样，假设长度为8</p>
<pre><code>NSData   *dataStream  = [@<span class="number">8</span> dataUsingEncodin<span class="variable">g:NSUTF8StringEncoding</span>];

[self.socket writeDat<span class="variable">a:dataStream</span> withTimeou<span class="variable">t:1</span> <span class="keyword">ta</span><span class="variable">g:1</span>];
</code></pre><p>接收数据<br>为了能时刻接收到socket的消息，我们在长连接方法中进行读取数据</p>
<pre><code>[self.socket readDataWithTimeou<span class="variable">t:30</span> <span class="keyword">ta</span><span class="variable">g:0</span>];
</code></pre><p>如果得到数据，会调用回调方法</p>
<pre><code>-(<span class="typename">void</span>)<span class="string">onSocket:</span>(AsyncSocket *)sock <span class="string">didReadData:</span>(NSData *)data <span class="string">withTag:</span>(<span class="typename">long</span>)tag
{
<span class="comment">// 对得到的data值进行解析与转换即可</span>

[self.socket <span class="string">readDataWithTimeout:</span><span class="number">30</span> <span class="string">tag:</span><span class="number">0</span>];

}
</code></pre><ol>
<li>简单使用说明</li>
</ol>
<p>我们在用户登录后的第一个界面进行socket的初始化连接操作，在得到数据后，将所需要显示的数据放在singleton中，对变量进行监听后做出相应的操作即可，延伸起来比较复杂，没有真实数据也不太方便说明，大家自己进行探索吧，有问题请在下方留言</p>
<pre><code>[<span class="name">Singleton</span> <span class="atom">sharedInstance</span>].<span class="atom">socketHost</span> = @<span class="string">"192.186.100.21"</span>;// <span class="atom">host</span>设定
[<span class="name">Singleton</span> <span class="atom">sharedInstance</span>].<span class="atom">socketPort</span> = <span class="number">10045</span>;// <span class="atom">port</span>设定

// 在连接前先进行手动断开
[<span class="name">Singleton</span> <span class="atom">sharedInstance</span>].<span class="atom">socket</span>.<span class="atom">userData</span> = <span class="name">SocketOfflineByUser</span>;
[[<span class="name">Singleton</span> <span class="atom">sharedInstance</span>] <span class="atom">cutOffSocket</span>];

// 确保断开后再连，如果对一个正处于连接状态的<span class="atom">socket</span>进行连接，会出现崩溃
[<span class="name">Singleton</span> <span class="atom">sharedInstance</span>].<span class="atom">socket</span>.<span class="atom">userData</span> = <span class="name">SocketOfflineByServer</span>;
[[<span class="name">Singleton</span> <span class="atom">sharedInstance</span>] <span class="atom">socketConnectHost</span>];
</code></pre>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-三个月开发心得" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/03/25/三个月开发心得/" class="article-date">
  	<time datetime="2016-03-25T08:13:54.000Z" itemprop="datePublished">2016-03-25</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/25/三个月开发心得/">三个月开发心得</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>//隐藏 </p>
<pre><code><span class="keyword">self</span><span class="variable">.tableView</span><span class="variable">.showsVerticalScrollIndicator</span> = <span class="literal">NO</span>;
</code></pre><p>//修改颜色    </p>
<pre><code><span class="keyword">self</span><span class="variable">.tableView</span><span class="variable">.indicatorStyle</span>=<span class="built_in">UIScrollViewIndicatorStyleWhite</span>;

cell<span class="variable">.accessoryType</span> = <span class="built_in">UITableViewCellAccessoryDisclosureIndicator</span>; <span class="comment">//显示最右边的箭头 </span>
</code></pre><p>//tableview没有数据的时候不显示线</p>
<pre><code>_tableView.tableFooterView = <span class="comment">[<span class="comment">[UIView alloc]</span> init]</span>;
</code></pre><p>//隐藏cell的那条线</p>
<pre><code>tableView.separatorStyle = UITableViewCellSeparatorStyleNone<span class="comment">;</span>
</code></pre><p>//取消点击选中效果</p>
<pre><code><span class="tag">-</span> (void)<span class="tag">tableView</span>:(UITableView *)<span class="tag">tableView</span> <span class="tag">didSelectRowAtIndexPath</span>:(NSIndexPath *)<span class="tag">indexPath</span>
{
<span class="attr_selector">[tableView deselectRowAtIndexPath:indexPath animated:YES]</span>;
}
</code></pre><p>// 隐藏item</p>
<pre><code><span class="keyword">self</span>.navigationItem.leftBarButtonItem = <span class="literal">nil</span>; 
</code></pre><p>有时候有些操作是防止用户在一次响应结束中再响应下一个。但有些测试用户就要猛点，狂点。像这种恶意就要进行防止。<br>当然有些异步操作时，可以在调用前enable 掉。等CallBACK 后再enable起来。过程中按钮是不能点的。<br>1、可以使用：</p>
<pre><code>- (<span class="keyword">void</span>) timeEnough
{
<span class="built_in">UIButton</span> *btn=(<span class="built_in">UIButton</span>*)[<span class="keyword">self</span><span class="variable">.view</span> viewWithTag:<span class="number">33</span>];
btn<span class="variable">.selected</span>=<span class="literal">NO</span>;
}
- (<span class="keyword">void</span>) btnDone:(<span class="built_in">UIButton</span>*)btn
{
<span class="keyword">if</span>(btn<span class="variable">.selected</span>) <span class="keyword">return</span>;
btn<span class="variable">.selected</span>=<span class="literal">YES</span>;
[<span class="keyword">self</span> performSelector:<span class="keyword">@selector</span>(timeEnough) withObject:<span class="literal">nil</span> afterDelay:<span class="number">3.0</span>]; <span class="comment">//使用延时进行限制。</span>
<span class="comment">//to do something.</span>
｝
</code></pre><p>2、个人觉得这种方法更为好用些。</p>
<pre><code><span class="tag">-</span> (void)<span class="tag">todoSomething</span>:(id)<span class="tag">sender</span>
{
<span class="comment">//在这里做按钮的想做的事情。</span>
}
<span class="tag">-</span> (void)<span class="tag">starButtonClicked</span>:(id)<span class="tag">sender</span>
{
<span class="comment">//先将未到时间执行前的任务取消。</span>
<span class="attr_selector">[[self class]</span> <span class="tag">cancelPreviousPerformRequestsWithTarget</span><span class="pseudo">:self</span> <span class="tag">selector</span>:@<span class="tag">selector</span>(<span class="attribute">todoSomething</span>:) <span class="tag">object</span><span class="pseudo">:sender</span>];
<span class="attr_selector">[self performSelector:@selector(todoSomething:) withObject:sender afterDelay:0.2f]</span>;
}
</code></pre><p>对于第二种方法，快速点击Ｎ次，只要每次间隔在0.2秒内的都不响应操作，等到停下点击到达0.2秒后再执行。所以按照自己的需要设置响应时间，狂点吧。只响应一次。。</p>
<p>在解决这个问题的时候，网上查了一下，都是这篇文章。还被转载了好多次。<br>我试了试，第二种方法是有问题的，事实上0.2秒发出响应后再到事件的完成中间依然可以点击产生重复响应。等于延时了0.2秒再犯错。<br>第一种倒是可以的，只是延时总是觉得不是很合理，我的事件是推出一个视图，所以我把btn.selected=NO;放在了will appear里面。</p>
<p>// 防止collection多次响应事件</p>
<pre><code>[collectionView <span class="string">setUserInteractionEnabled:</span>NO];
[collectionView <span class="string">performSelector:</span><span class="annotation">@selector</span>(<span class="string">setUserInteractionEnabled:</span>)
<span class="label">                     withObject:</span>[NSNumber <span class="string">numberWithBool:</span>YES] <span class="string">afterDelay:</span><span class="number">0.5</span>f];
</code></pre><p>//取得本地程序的版本号 </p>
<pre><code>NSDictionary *<span class="built_in">local</span>Dic =[[NSBundle mainBundle]     infoDictionary];

NSString *<span class="built_in">local</span>Version =[<span class="built_in">local</span>Dic     objectForKey:@<span class="string">"CFBundleShortVersionString"</span>];
</code></pre>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-AFNetworking-3-0迁移指南" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/02/02/AFNetworking-3-0迁移指南/" class="article-date">
  	<time datetime="2016-02-02T04:40:52.000Z" itemprop="datePublished">2016-02-02</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/02/02/AFNetworking-3-0迁移指南/">AFNetworking 3.0迁移指南</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="AFNetworking_3-0">AFNetworking 3.0</h2><pre><code>AFNetworking是一款在OS X和iOS下都令人喜爱的网络库。为了迎合iOS新版本的升级, AFNetworking在<span class="number">3.0</span>版本中删除了基于 <span class="built_in">NSURLConnection</span> API的所有支持。如果你的项目以前使用过这些API，建议您立即升级到基于 <span class="built_in">NSURLSession</span> 的API的AFNetworking的版本。本指南将引导您完成这个过程。
</code></pre><p>本指南是为了引导使用AFNetworking 2.x升级到最新的版本API，以达到过渡的目的，并且解释了新增和更改的设计结构。</p>
<h2 id="新设备要求:_iOS_7,_Mac_OS_X_10-9,_watchOS_2,_tvOS_9,_&amp;_Xcode_7">新设备要求: iOS 7, Mac OS X 10.9, watchOS 2, tvOS 9, &amp; Xcode 7</h2><p>AFNetworking 3.0正式支持的iOS 7， Mac OS X的10.9， watchOS 2 ， tvOS 9 和Xcode 7。如果你想使用AFNetworking在针对较旧版本的SDK项目，请检查README的兼容性信息。</p>
<h2 id="NSURLConnection的API已废弃">NSURLConnection的API已废弃</h2><p>AFNetworking 1.0建立在NSURLConnection的基础API之上 ，AFNetworking 2.0开始使用NSURLConnection的基础API ，以及较新基于NSURLSession的API的选项。 AFNetworking 3.0现已完全基于NSURLSession的API，这降低了维护的负担，同时支持苹果增强关于NSURLSession提供的任何额外功能。由于Xcode 7中，NSURLConnection的API已经正式被苹果弃用。虽然该API将继续运行，但将没有新功能将被添加，并且苹果已经通知所有基于网络的功能，以充分使NSURLSession向前发展。<br>AFNetworking 2.X将继续获得关键的隐患和安全补丁，但没有新的功能将被添加。Alamofire(Swift下的网络请求)软件基金会建议，所有的项目迁移到基于NSURLSession的API。</p>
<h3 id="弃用的类">弃用的类</h3><p>下面的类已从AFNetworking 3.0中废弃：</p>
<ul>
<li>AFURLConnectionOperation</li>
<li>AFHTTPRequestOperation</li>
<li>AFHTTPRequestOperationManager</li>
</ul>
<h3 id="修改的类">修改的类</h3><p>下面的类包含基于NSURLConnection的API的内部实现。他们已经被使用NSURLSession重构:</p>
<ul>
<li>UIImageView+AFNetworking</li>
<li>UIWebView+AFNetworking</li>
<li>UIButton+AFNetworking</li>
</ul>
<h3 id="迁移">迁移</h3><h4 id="AFHTTPRequestOperationManager_核心代码">AFHTTPRequestOperationManager 核心代码</h4><p>如果你以前使用 AFHTTPRequestOperationManager ， 你将需要迁移去使用 AFHTTPSessionManager。 以下的类在两者过渡间并没有变化：</p>
<ul>
<li>securityPolicy</li>
<li>requestSerializer</li>
<li>responseSerializer</li>
</ul>
<p>接下来举一个关于AFHTTPSessionManager的简单例子。注意HTTP网络请求返回的不再是AFHTTPRequestOperation, 修改成为了NSURLSessionTask，并且成功和失败的Block块中的参数也变更为了NSURLSessionTask，而不再是AFHTTPRequestOperation。</p>
<h4 id="AFNetworking_2-x">AFNetworking 2.x</h4><pre><code>AFHTTPRequestOperationManager *manager = [AFHTTPRequestOperationManager manager];
[manager GET:<span class="string">@"请求的url"</span> parameters:<span class="literal">nil</span> success:^(AFHTTPRequestOperation *operation, <span class="keyword">id</span> responseObject) {
    <span class="built_in">NSLog</span>(<span class="string">@"成功"</span>);
} failure:^(AFHTTPRequestOperation *operation, <span class="built_in">NSError</span>*error) {
    <span class="built_in">NSLog</span>(<span class="string">@"失败"</span>);
}];
</code></pre><h4 id="AFNetworking_3-0-1">AFNetworking 3.0</h4><pre><code>AFHTTPSessionManager *session = [AFHTTPSessionManager manager];
[session GET:<span class="string">@"请求的url"</span> parameters:<span class="literal">nil</span> success:^(<span class="built_in">NSURLSessionDataTask</span> *task, <span class="keyword">id</span> responseObject) {
    <span class="built_in">NSLog</span>(<span class="string">@"成功"</span>);
} failure:^(<span class="built_in">NSURLSessionDataTask</span> *task, <span class="built_in">NSError</span> *error) {
    <span class="built_in">NSLog</span>(<span class="string">@"失败"</span>);        
}];
</code></pre><h4 id="AFHTTPRequestOperation_核心代码">AFHTTPRequestOperation 核心代码</h4><p>与NSURLConnection对象不同，每个共享应用范围的设置如会话管理、缓存策略、Cookie存储以及URL协议等，这些NSURLSession对象都可以单独进行配置。使用特定的配置来初始化会话，它可以发送任务来获取数据，并上传或下载文件。</p>
<p>在AFNetworking 2.0中，使用AFHTTPRequestOperation，有可能创建一个没有额外开销的独立的网络请求来获取数据。NSURLSession则需要更多的开销，为了获得所要请求的数据。</p>
<p>接下来，将要通过AFHTTPSessionManager创建一个对象，并创建一个任务和启动它。</p>
<h4 id="AFNetworking_2-x-1">AFNetworking 2.x</h4><pre><code><span class="built_in">NSURL</span> *URL = [<span class="built_in">NSURL</span> URLWithString:<span class="string">@""</span>];
<span class="built_in">NSURLRequest</span> *request = [<span class="built_in">NSURLRequest</span> requestWithURL:URL];
AFHTTPRequestOperation *op = [[AFHTTPRequestOperation alloc] initWithRequest:request];
op<span class="variable">.responseSerializer</span> = [AFJSONResponseSerializer serializer];
[op setCompletionBlockWithSuccess:^(AFHTTPRequestOperation *operation, <span class="keyword">id</span> responseObject) {
    <span class="built_in">NSLog</span>(<span class="string">@"JSON: %@"</span>, responseObject);
} failure:^(AFHTTPRequestOperation *operation, <span class="built_in">NSError</span> *error) {
    <span class="built_in">NSLog</span>(<span class="string">@"Error: %@"</span>, error);
}];
[[<span class="built_in">NSOperationQueue</span> mainQueue] addOperation:op];
</code></pre><h4 id="AFNetworking_3-0-2">AFNetworking 3.0</h4><pre><code><span class="built_in">NSURL</span> *URL = [<span class="built_in">NSURL</span> URLWithString:<span class="string">@""</span>];
AFHTTPSessionManager *manager = [AFHTTPSessionManager manager];
[manager GET:URL<span class="variable">.absoluteString</span> parameters:<span class="literal">nil</span> success:^(<span class="built_in">NSURLSessionTask</span> *task, <span class="keyword">id</span> responseObject) {
    <span class="built_in">NSLog</span>(<span class="string">@"JSON: %@"</span>, responseObject);
} failure:^(<span class="built_in">NSURLSessionTask</span> *operation, <span class="built_in">NSError</span> *error) {
    <span class="built_in">NSLog</span>(<span class="string">@"Error: %@"</span>, error);
}];
 <span class="built_in">NSDictionary</span> *parameters = @{};

[session POST:<span class="string">@""</span> parameters:parameters progress:^(<span class="built_in">NSProgress</span> * _Nonnull uploadProgress) {

} success:^(<span class="built_in">NSURLSessionDataTask</span> * _Nonnull task, <span class="keyword">id</span>  _Nullable responseObject) {
    <span class="built_in">NSLog</span>(<span class="string">@"JSON:%@"</span>,responseObject);
} failure:^(<span class="built_in">NSURLSessionDataTask</span> * _Nullable task, <span class="built_in">NSError</span> * _Nonnull error) {
    <span class="built_in">NSLog</span>(<span class="string">@"error"</span>);
}];
</code></pre><h4 id="UIKit的迁移">UIKit的迁移</h4><p>图片下载已经被重构，以遵循AlamofireImage架构与新的AFImageDownloader类。这个类的图片下载职责的代理人是UIButton与UIImageView的类目，并且提供了一些方法，在必要时可以自定义。类别中，下载远程图片的实际方法没有改变。</p>
<p>UIWebView的类目被重构为使用AFHTTPSessionManager作为其网络请求。</p>
<h4 id="UIAlertView的类目被废弃">UIAlertView的类目被废弃</h4><p>从AFNetworking 3.0后UIAlertView的类目因过时而被废弃。并没有提供UIAlertController类目的计划，因为这是应用程序应处理的逻辑，而不是这个库。</p>
<p>原文链接: <a href="https://github.com/AFNetworking/AFNetworking/wiki/AFNetworking-3.0-Migration-Guide#new-requirements-ios-7-mac-os-x-109-watchos-2-tvos-9--xcode-7" target="_blank" rel="external">AFNetworking 3.0</a></p>
<p>纯属个人翻译，如有错误，还请纠正。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/AFNetworking/">AFNetworking</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-推荐一个聊天界面的UI" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/01/29/推荐一个聊天界面的UI/" class="article-date">
  	<time datetime="2016-01-29T01:40:15.000Z" itemprop="datePublished">2016-01-29</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/01/29/推荐一个聊天界面的UI/">推荐一个聊天界面的UI</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="MQChatViewController">MQChatViewController</h1><p>An easy-to-customize messages UI Library for iOS.</p>
<p><strong>MQChatViewController</strong> 是一套易于定制的 iOS 开源聊天界面。</p>
<h2 id="为什么再写一套聊天_Library？">为什么再写一套聊天 Library？</h2><p>之前在其他项目中用过 <a href="https://github.com/jessesquires/JSQMessagesViewController" target="_blank" rel="external">JSQMessagesViewController</a> 和 <a href="https://github.com/ZhipingYang/UUChatTableView" target="_blank" rel="external">UUChatTableView</a>，两个开源项目都很好，但由于 JSQMessage 多文字气泡<a href="https://github.com/jessesquires/JSQMessagesViewController/issues/492" target="_blank" rel="external">卡顿的问题</a>迟迟得不到解决，UUChatView 增加自定义 Cell 并不是那么方便，所以决定写一套方便自定义的聊天界面。</p>
<h2 id="Goal_-_目标">Goal - 目标</h2><p>该聊天界面的<strong>目标</strong>是，<strong>能让开发者很方便地进行定制</strong>。</p>
<p>为了达成该目标，该 Library 做了如下设计：</p>
<ul>
<li>避免 MVC (Massive View Controller)，将 TableView、TableView 的 DataSource 和 ViewController 的数据管理都独立出去，ViewController 只充当 View 和 Model 的接口；</li>
<li>为每一种 Cell 建立一个单独的类，以方便开发者进行修改和替换；</li>
<li>所有的 Cell 都继承于一个基 Cell，这样开发者就不需要修改 DataSource 中的逻辑；</li>
<li>所有的 CellModel 都必须满足一类协议方法，避免开发者过多的修改数据管理的逻辑；</li>
<li>如果开发者不需要再自定义其他的 View，则不需要修改 ViewController；</li>
</ul>
<h2 id="Usage_-_使用方法">Usage - 使用方法</h2><p>最简单的使用方式，即初始化 <code>MQChatViewManager</code>，然后对界面进行配置，最后调用启动聊天界面接口即可；</p>
<p>如果你想在某一个 ViewController，Push 一个聊天界面，可复制下面两行代码：<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MQChatViewManager *chatViewManager = [[MQChatViewManager alloc] init];&#10;[chatViewManager pushMQChatViewControllerInViewController:self];</span><br></pre></td></tr></table></figure></p>
<p>有关聊天界面的配置，请见文档末尾的 <a href="#configuration---配置">Configuration</a> 小节.</p>
<h2 id="Project_Structure_-_代码结构">Project Structure - 代码结构</h2><table>
<thead>
<tr>
<th>文件</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://github.com/Meiqia/MQChatViewController/tree/master/MQChatViewControllerDemo/MQChatViewController/ChatViewManager" target="_blank" rel="external">Config/</a></td>
<td>对聊天界面进行配置的文件</td>
</tr>
<tr>
<td><a href="https://github.com/Meiqia/MQChatViewController/blob/master/MQChatViewControllerDemo/MQChatViewController/ViewController/MQChatViewController.h" target="_blank" rel="external">Controllers/MQChatViewController</a></td>
<td>界面的 Controller 类</td>
</tr>
<tr>
<td><a href="https://github.com/Meiqia/MQChatViewController/blob/master/MQChatViewControllerDemo/MQChatViewController/ViewController/MQChatViewService.h" target="_blank" rel="external">Controllers/MQChatViewService</a></td>
<td>界面的数据管理类，开发者可在该类中对接自己项目的 APIManager，来进行发送、收取消息等业务逻辑</td>
</tr>
<tr>
<td><a href="https://github.com/Meiqia/MQChatViewController/blob/master/MQChatViewControllerDemo/MQChatViewController/ViewController/MQChatViewTableDataSource.h" target="_blank" rel="external">Controllers/MQChatViewTableDataSource</a></td>
<td>消息的 TableView 的 DataSource，开发者不需要修改该类</td>
</tr>
<tr>
<td><a href="https://github.com/Meiqia/MQChatViewController/blob/master/MQChatViewControllerDemo/MQChatViewController/ViewController/MQChatTableView.h" target="_blank" rel="external">Views/MQChatTableView</a></td>
<td>消息的 TableView</td>
</tr>
<tr>
<td><a href="https://github.com/Meiqia/MQChatViewController/tree/master/MQChatViewControllerDemo/MQChatViewController/ChatCells/CellModel" target="_blank" rel="external">TableCells/CellModel</a></td>
<td>自定义 Cell 的 ViewModel，进行内容转换、布局计算等等</td>
</tr>
<tr>
<td><a href="https://github.com/Meiqia/MQChatViewController/tree/master/MQChatViewControllerDemo/MQChatViewController/ChatCells/Cell" target="_blank" rel="external">TableCells/CellView</a></td>
<td>自定义的 Cell，Cell 中的View直接使用在相应的 CellModel 中计算好的数据</td>
</tr>
<tr>
<td><a href="https://github.com/Meiqia/MQChatViewController/tree/master/MQChatViewControllerDemo/MQChatViewController/ChatMessages" target="_blank" rel="external">MessageModels/</a></td>
<td>该文件夹中的类是该 Library 会用到的 Message 实体</td>
</tr>
<tr>
<td><a href="https://github.com/Meiqia/MQChatViewController/tree/master/MQChatViewControllerDemo/MQChatViewController/ChatUtil" target="_blank" rel="external">Utils/</a></td>
<td>自定义的工具类</td>
</tr>
<tr>
<td><a href="https://github.com/Meiqia/MQChatViewController/tree/master/MQChatViewControllerDemo/MQChatViewController/Views" target="_blank" rel="external">Views/</a></td>
<td>界面中用到的自定义 View，如聊天 TableView、下拉刷新、输入框等等</td>
</tr>
<tr>
<td><a href="https://github.com/Meiqia/MQChatViewController/tree/master/MQChatViewControllerDemo/MQChatViewController/MQChatViewBundle.bundle" target="_blank" rel="external">Assets/MQChatViewAsset.bundle</a></td>
<td>资源文件，如图片、声音文件等，<strong>注意</strong>用户如果需要通过 MQChatViewManager 修改自定义元素图片，需要将图片放在该 bundle 中</td>
</tr>
<tr>
<td><a href="https://github.com/Meiqia/MQChatViewController/tree/master/MQChatViewControllerDemo/MQChatViewController/Vendors" target="_blank" rel="external">Vendors/</a></td>
<td>第三方开源库</td>
</tr>
</tbody>
</table>
<p>注意：</p>
<ul>
<li>代码中的预处理是为了剥离美洽 SDK 的逻辑，如果你不是美洽 SDK 的用户，可将代码中所有 <code>#ifdef INCLUDE_MEIQIA_SDK</code> 中的逻辑换成自己的API逻辑，如下方：</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#ifdef INCLUDE_MEIQIA_SDK&#10;//&#35843;&#29992;&#32654;&#27965;&#30340;API&#36923;&#36753;&#10;#endif</span><br></pre></td></tr></table></figure>
<ul>
<li>如果你是美洽 SDK 用户，则需要在 <code>MQChatViewConfig.h</code> 中，取消下面 define 的注释，以便打开美洽的 API：</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">//&#26159;&#21542;&#24341;&#20837;&#32654;&#27965;SDK&#10;//#define INCLUDE_MEIQIA_SDK</span><br></pre></td></tr></table></figure>
<h2 id="Demo_-_示例">Demo - 示例</h2><p>开发者可参考 Demo 中的用法，对聊天界面进行配置，来进行基本的自定义功能，例如下面的示例：</p>
<p><strong>开发者可这样 push 出聊天界面，效果如下：</strong><br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MQChatViewManager *chatViewManager = [[MQChatViewManager alloc] init];&#10;   [chatViewManager pushMQChatViewControllerInViewController:self];</span><br></pre></td></tr></table></figure></p>
<p><img src="https://github.com/ijinmao/MQChatViewController/blob/master/DemoGif/MQChatViewDemo1.gif" alt="screenshot1"></p>
<hr>
<p><strong>开发者可这样 present 出聊天界面的模态视图，效果如下：</strong><br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MQChatViewManager *chatViewManager = [[MQChatViewManager alloc] init];&#10;   [chatViewManager presentMQChatViewControllerInViewController:self];</span><br></pre></td></tr></table></figure></p>
<p><img src="https://github.com/ijinmao/MQChatViewController/blob/master/DemoGif/MQChatViewDemo2.gif" alt="screenshot2"></p>
<hr>
<p><strong>开发者可这样配置：底部按钮、修改气泡颜色、文字颜色、使头像设为圆形，效果如下：</strong><br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[chatViewManager setPhotoSenderImage:photoImage highlightedImage:photoHighlightedImage];&#10;   [chatViewManager setVoiceSenderImage:voiceImage highlightedImage:voiceHighlightedImage];&#10;   [chatViewManager setTextSenderImage:keyboardImage highlightedImage:keyboardHighlightedImage];&#10;   [chatViewManager setResignKeyboardImage:resightKeyboardImage highlightedImage:resightKeyboardHighlightedImage];&#10;   [chatViewManager setIncomingBubbleColor:[UIColor redColor]];&#10;   [chatViewManager setIncomingMessageTextColor:[UIColor whiteColor]];&#10;   [chatViewManager setOutgoingBubbleColor:[UIColor yellowColor]];&#10;   [chatViewManager setOutgoingMessageTextColor:[UIColor darkTextColor]];&#10;   [chatViewManager enableRoundAvatar:true];&#10;   [chatViewManager pushMQChatViewControllerInViewController:self];</span><br></pre></td></tr></table></figure></p>
<p><img src="https://github.com/ijinmao/MQChatViewController/blob/master/DemoGif/MQChatViewDemo3.gif" alt="screenshot3"></p>
<hr>
<p><strong>开发者可这样配置：是否支持发送语音、是否显示本机头像、修改气泡的样式，效果如下：</strong><br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[chatViewManager enableSendVoiceMessage:false];&#10;[chatViewManager enableClientAvatar:false];&#10;[chatViewManager setIncomingBubbleImage:incomingBubbleImage];&#10;[chatViewManager setOutgoingBubbleImage:outgoingBubbleImage];&#10;[chatViewManager setBubbleImageStretchInsets:UIEdgeInsetsMake(stretchPoint.y, stretchPoint.x, incomingBubbleImage.size.height-stretchPoint.y+0.5, stretchPoint.x)];&#10;[chatViewManager pushMQChatViewControllerInViewController:self];</span><br></pre></td></tr></table></figure></p>
<p><img src="https://github.com/ijinmao/MQChatViewController/blob/master/DemoGif/MQChatViewDemo4.gif" alt="screenshot4"></p>
<hr>
<p><strong>开发者可这样配置：增加可点击链接的正则表达式( Library 本身已支持多种格式链接，如未满足需求可增加)、增加欢迎语、是否开启消息声音、修改接受消息的铃声，效果如下：</strong><br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[chatViewManager setMessageLinkRegex:@&#34;((http[s]&#123;0,1&#125;|ftp)://[a-zA-Z0-9\\.\\-]+\\.([a-zA-Z]&#123;2,4&#125;)(:\\d+)?(/[a-zA-Z0-9\\.\\-~!@#$%^&#38;*+?:_/=&#60;&#62;]*)?)|([a-zA-Z0-9\\.\\-]+\\.([a-zA-Z]&#123;2,4&#125;)(:\\d+)?(/[a-zA-Z0-9\\.\\-~!@#$%^&#38;*+?:_/=&#60;&#62;]*)?)&#34;];&#10;   [chatViewManager enableChatWelcome:true];&#10;   [chatViewManager setChatWelcomeText:@&#34;&#20320;&#22909;&#65292;&#35831;&#38382;&#26377;&#20160;&#20040;&#21487;&#20197;&#24110;&#21161;&#21040;&#24744;&#65311;&#34;];&#10;   [chatViewManager setIncomingMessageSoundFileName:@&#34;MQNewMessageRingStyle2.wav&#34;];&#10;   [chatViewManager enableMessageSound:true];&#10;   [chatViewManager pushMQChatViewControllerInViewController:self];</span><br></pre></td></tr></table></figure></p>
<p><img src="https://github.com/ijinmao/MQChatViewController/blob/master/DemoGif/MQChatViewDemo5.gif" alt="screenshot5"></p>
<hr>
<p><strong>如果 tableView 没有在底部，开发者可这样打开消息的提示，效果如下：</strong><br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[chatViewManager enableShowNewMessageAlert:true];&#10;   [chatViewManager pushMQChatViewControllerInViewController:self];</span><br></pre></td></tr></table></figure></p>
<p><img src="https://github.com/ijinmao/MQChatViewController/blob/master/DemoGif/MQChatViewDemo6.gif" alt="screenshot6"></p>
<hr>
<p><strong>开发者可这样配置：是否支持下拉刷新、修改下拉刷新颜色、增加导航栏标题，效果如下：</strong><br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[chatViewManager enableTopPullRefresh:true];&#10;   [chatViewManager setPullRefreshColor:[UIColor redColor]];&#10;   [chatViewManager setNavTitleText:@&#34;&#32654;&#27965;SDK&#34;];&#10;   [chatViewManager pushMQChatViewControllerInViewController:self];</span><br></pre></td></tr></table></figure></p>
<p><img src="https://github.com/ijinmao/MQChatViewController/blob/master/DemoGif/MQChatViewDemo7.gif" alt="screenshot7"></p>
<hr>
<p><strong>开发者可这样修改导航栏颜色、导航栏左右键、取消图片消息的mask效果，效果如下：</strong><br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[chatViewManager setNavTitleText:@&#34;&#32654;&#27965;SDK&#34;];&#10;   [chatViewManager setNavigationBarTintColor:[UIColor redColor]];&#10;   [chatViewManager setNavRightButton:rightButton];&#10;   [chatViewManager pushMQChatViewControllerInViewController:self];</span><br></pre></td></tr></table></figure></p>
<p><img src="https://github.com/ijinmao/MQChatViewController/blob/master/DemoGif/MQChatViewDemo8.gif" alt="screenshot8"></p>
<h2 id="Customization_-_深度自定义">Customization - 深度自定义</h2><p><strong>3步添加自定义 Cell</strong></p>
<ul>
<li>添加自定义的 Cell 类，注意该 Cell 必须继承于 <code>MQChatBaseCell</code>;</li>
<li>添加自定义 Cell 的 CellModel，注意 CellModel 必须实现 <code>MQCellModelProtocol</code> 协议中的方法；</li>
<li>接下来你需要在 <code>MQChatViewService.m</code> 中，使用你自己的发送消息、接受消息的数据接口；注：你可以查看 <code>#ifdef INCLUDE_MEIQIA_SDK</code> 里面的内容，里面用到了我们数据层和UI层的中间接口 <code>MQServiceToViewInterface</code>；</li>
</ul>
<p><strong>替换加载图片的策略</strong></p>
<ul>
<li>该 Library 中没有使用<strong>图片/文件缓存</strong>等策略，加载图片的地方都新开了一个线程进行数据加载，如下方所示，开发者可根据自己的项目替换成不同的缓存策略，如 SDWebImage 等;</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#9;dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_HIGH, 0), ^&#123;&#10;#warning &#36825;&#37324;&#24320;&#21457;&#32773;&#21487;&#20197;&#20351;&#29992;&#33258;&#24049;&#30340;&#22270;&#29255;&#32531;&#23384;&#31574;&#30053;&#65292;&#22914;SDWebImage&#10;        NSData *imageData = [NSData dataWithContentsOfURL:[NSURL URLWithString:message.userAvatarPath]];&#10;    &#125;);</span><br></pre></td></tr></table></figure>
<h2 id="Configuration_-_配置">Configuration - 配置</h2><p>如果你不想修改聊天界面的内部逻辑，<code>MQChatViewManager</code> 提供了很多接口，可以实现一些自定义设置。</p>
<p>名词解释</p>
<table>
<thead>
<tr>
<th>名词</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>incoming</td>
<td>表示聊天对方</td>
</tr>
<tr>
<td>outgoing</td>
<td>表示本机用户</td>
</tr>
</tbody>
</table>
<p>下面列举一些常用的配置聊天界面的接口如下：(详细请见 <a href="https://github.com/ijinmao/MQChatViewController/blob/master/MQChatViewControllerDemo/MQChatViewController/ChatViewManager/MQChatViewManager.h" target="_blank" rel="external">MQChatViewManager.h</a>)<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/**&#10; * @brief &#22686;&#21152;&#28040;&#24687;&#20013;&#21487;&#36873;&#20013;&#30340;&#38142;&#25509;&#30340;&#27491;&#21017;&#34920;&#36798;&#24335;&#65292;&#29992;&#20110;&#21305;&#37197;&#28040;&#24687;&#65292;&#28385;&#36275;&#26465;&#20214;&#27573;&#33853;&#21487;&#20197;&#34987;&#29992;&#25143;&#28857;&#20987;&#12290;&#10; * @param numberRegex &#38142;&#25509;&#30340;&#27491;&#21017;&#34920;&#36798;&#24335;&#10; */&#10;- (void)setMessageLinkRegex:(NSString *)linkRegex;&#10;&#10;/**&#10; * @brief &#22686;&#21152;&#28040;&#24687;&#20013;&#21487;&#36873;&#20013;&#30340;email&#30340;&#27491;&#21017;&#34920;&#36798;&#24335;&#65292;&#29992;&#20110;&#21305;&#37197;&#28040;&#24687;&#65292;&#28385;&#36275;&#26465;&#20214;&#27573;&#33853;&#21487;&#20197;&#34987;&#29992;&#25143;&#28857;&#20987;&#12290;&#10; * @param emailRegex email&#30340;&#27491;&#21017;&#34920;&#36798;&#24335;&#10; */&#10;- (void)setMessageEmailRegex:(NSString *)emailRegex;&#10;&#10;/**&#10; * @brief &#35774;&#32622;&#25910;&#21040;&#28040;&#24687;&#30340;&#22768;&#38899;&#65307;&#10; * @param soundFileName &#22768;&#38899;&#25991;&#20214;&#10; */&#10;- (void)setIncomingMessageSoundFileName:(NSString *)soundFileName;&#10;&#10;/**&#10; * @brief &#26159;&#21542;&#25903;&#25345;&#21457;&#36865;&#35821;&#38899;&#28040;&#24687;&#65307;&#10; * @param enable YES:&#25903;&#25345;&#21457;&#36865;&#35821;&#38899;&#28040;&#24687; NO:&#19981;&#25903;&#25345;&#21457;&#36865;&#35821;&#38899;&#28040;&#24687;&#10; */&#10;- (void)enableSendVoiceMessage:(BOOL)enable;&#10;&#10;/**&#10; * @brief &#26159;&#21542;&#25903;&#25345;&#21457;&#36865;&#22270;&#29255;&#28040;&#24687;&#65307;&#10; * @param enable YES:&#25903;&#25345;&#21457;&#36865;&#22270;&#29255;&#28040;&#24687; NO:&#19981;&#25903;&#25345;&#21457;&#36865;&#22270;&#29255;&#28040;&#24687;&#10; */&#10;- (void)enableSendImageMessage:(BOOL)enable;&#10;&#10;/**&#10; * @brief &#26159;&#21542;&#25903;&#25345;&#23545;&#26041;&#22836;&#20687;&#30340;&#26174;&#31034;&#65307;&#10; * @param enable YES:&#25903;&#25345; NO:&#19981;&#25903;&#25345;&#10; */&#10;- (void)enableIncomingAvatar:(BOOL)enable;&#10;&#10;/**&#10; * @brief &#26159;&#21542;&#25903;&#25345;&#24403;&#21069;&#29992;&#25143;&#22836;&#20687;&#30340;&#26174;&#31034;&#10; *&#10; * @param enable YES:&#25903;&#25345; NO:&#19981;&#25903;&#25345;&#10; */&#10;- (void)enableOutgoingAvatar:(BOOL)enable;&#10;&#10;/**&#10; * @brief &#26159;&#21542;&#24320;&#21551;&#25509;&#21463;/&#21457;&#36865;&#28040;&#24687;&#30340;&#22768;&#38899;&#65307;&#10; * @param enable YES:&#24320;&#21551;&#22768;&#38899; NO:&#20851;&#38381;&#22768;&#38899;&#10; */&#10;- (void)enableMessageSound:(BOOL)enable;&#10;&#10;/**&#10; * @brief &#26159;&#21542;&#24320;&#21551;&#19979;&#25289;&#21047;&#26032;&#65288;&#39030;&#37096;&#21047;&#26032;&#65289;&#10; *&#10; * @param enable YES:&#25903;&#25345; NO:&#19981;&#25903;&#25345;&#10; */&#10;- (void)enableTopPullRefresh:(BOOL)enable;&#10;&#10;/**&#10; *  @brief &#35774;&#32622;&#19979;&#25289;/&#19978;&#25289;&#21047;&#26032;&#30340;&#39068;&#33394;&#10; *&#10; *  @param pullRefreshColor &#39068;&#33394;&#10; */&#10;- (void)setPullRefreshColor:(UIColor *)pullRefreshColor;&#10;&#10;/**&#10; * @brief &#35774;&#32622;&#21457;&#36865;&#36807;&#26469;&#30340;message&#30340;&#25991;&#23383;&#39068;&#33394;&#65307;&#10; * @param textColor &#25991;&#23383;&#39068;&#33394;&#10; */&#10;- (void)setIncomingMessageTextColor:(UIColor *)textColor;&#10;&#10;/**&#10; *  @brief &#35774;&#32622;&#21457;&#36865;&#36807;&#26469;&#30340;message&#27668;&#27873;&#39068;&#33394;&#10; *&#10; *  @param bubbleColor &#27668;&#27873;&#39068;&#33394;&#10; */&#10;- (void)setIncomingBubbleColor:(UIColor *)bubbleColor;&#10;&#10;/**&#10; * @brief &#35774;&#32622;&#21457;&#36865;&#20986;&#21435;&#30340;message&#30340;&#25991;&#23383;&#39068;&#33394;&#65307;&#10; * @param textColor &#25991;&#23383;&#39068;&#33394;&#10; */&#10;- (void)setOutgoingMessageTextColor:(UIColor *)textColor;&#10;&#10;/**&#10; *  @brief &#35774;&#32622;&#21457;&#36865;&#30340;message&#27668;&#27873;&#39068;&#33394;&#10; *&#10; *  @param bubbleColor &#27668;&#27873;&#39068;&#33394;&#10; */&#10;- (void)setOutgoingBubbleColor:(UIColor *)bubbleColor;</span><br></pre></td></tr></table></figure></p>
<p>更多配置请见 <a href="https://github.com/Meiqia/MQChatViewController/blob/master/MQChatViewControllerDemo/MQChatViewController/Config/MQChatViewManager.h" target="_blank" rel="external">MQChatViewManager.h</a> 文件。</p>
<h2 id="Localization_-_国际化/本地化">Localization - 国际化/本地化</h2><p>本项目支持<a href="https://github.com/Meiqia/MQChatViewController/blob/master/MQChatViewControllerDemo/MQChatViewController/Assets/MQChatViewAsset.bundle/en.lproj/MQChatViewController.strings" target="_blank" rel="external">英文</a>、<a href="https://github.com/Meiqia/MQChatViewController/blob/master/MQChatViewControllerDemo/MQChatViewController/Assets/MQChatViewAsset.bundle/zh-Hans.lproj/MQChatViewController.strings" target="_blank" rel="external">简体中文</a>和<a href="https://github.com/Meiqia/MQChatViewController/blob/master/MQChatViewControllerDemo/MQChatViewController/Assets/MQChatViewAsset.bundle/zh-Hant.lproj/MQChatViewController.strings" target="_blank" rel="external">繁体中文</a>，语言的定义在 Assets/MQChatViewAsset.bundle 中。</p>
<p>如果开发者想增加多种语言，在 Assets/MQChatViewAsset.bundle 增加对应的语言项目即可。</p>
<p><strong>注意</strong></p>
<p>为了能正常识别App的系统语言，开发者的 App 的 info.plist 中需要有添加 Localizations 配置。如果需要支持英文、简体中文、繁体中文，info.plist 的 Souce Code 中需要有如下配置：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">key</span>&gt;</span>CFBundleLocalizations<span class="tag">&lt;/<span class="title">key</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">array</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="title">string</span>&gt;</span>zh_CN<span class="tag">&lt;/<span class="title">string</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="title">string</span>&gt;</span>zh_TW<span class="tag">&lt;/<span class="title">string</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="title">string</span>&gt;</span>en<span class="tag">&lt;/<span class="title">string</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">array</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="To-do-list_-_待修复问题">To-do-list - 待修复问题</h2><p>由于 SDK 发布催的很紧，以下问题还没有得到妥善解决，但影响不大，所以还没有修复，开发者打怪得分后可提 PR ^.^：</p>
<ul>
<li>目前只支持单张图片全屏浏览，还不支持多张图片浏览；</li>
<li>下拉刷新的瞬间，tableView 会跳跃一下，给人造成一种”卡了一下”的感觉；</li>
<li>启动上拉刷新(底部刷新)，只显示了 loading 的 indicator，没有显示出 loading 的 path 效果；</li>
<li>使用 TTTAttributedLabel，输入 emoji，text 会往下偏移；</li>
<li>TTTAttributedLabel 中使用了 NSUnderlineColorAttributeName，导致不兼容 iOS 6，所以对于 iOS 7 以下的用户，消息气泡中的文字用的是 UILabel；所以对于 iOS 7 以下用户，没有文字选中的效果；</li>
<li>开发者可在项目中搜索#warning，其中有一个 warning 是 TTTAttributedLabel 的 bug，开发者感兴趣可以解决一下；</li>
</ul>
<h2 id="Vendors_-_用到的第三方开源库">Vendors - 用到的第三方开源库</h2><p>以下是该 Library 用到的第三方开源代码，如果开发者的项目中用到了相同的库，需要删除一份，避免类名冲突：</p>
<table>
<thead>
<tr>
<th>第三方开源库</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://github.com/rs/SDWebImage" target="_blank" rel="external">SDWebImage</a></td>
<td>知名的异步图片下载和图片缓存库；</td>
</tr>
<tr>
<td>VoiceConvert</td>
<td>AMR 和 WAV 语音格式的互转；没找到出处，哪位童鞋找到来源后，请更新下文档~</td>
</tr>
<tr>
<td><a href="https://github.com/molon/MLAudioRecorder" target="_blank" rel="external">MLAudioRecorder</a></td>
<td>边录边转码，播放网络音频 Button (本地缓存)，实时语音。<strong>注意</strong>，由于该开源项目中的 <a href="https://github.com/molon/MLAudioRecorder/tree/master/MLRecorder/MLAudioRecorder/mp3_en_de/lame.framework" target="_blank" rel="external">lame.framework</a> 不支持 <code>bitCode</code> ，所以我们去掉了该项目中有关 MP3 的文件；</td>
</tr>
<tr>
<td><a href="https://github.com/michaelhenry/MHFacebookImageViewer" target="_blank" rel="external">MHFacebookImageViewer</a></td>
<td>图片查看器；<strong>注意</strong>，我们对该开源库进行了修改，以支持单击关闭Viewer等一些操作，该修改版本可见 <a href="https://github.com/ijinmao/MHFacebookImageViewer" target="_blank" rel="external">MHFacebookImageViewer</a>；</td>
</tr>
<tr>
<td><a href="https://github.com/lyokato/FBDigitalFont" target="_blank" rel="external">FBDigitalFont</a></td>
<td>类 LED 显示效果，用于本项目中的语音倒计时显示；</td>
</tr>
<tr>
<td><a href="https://github.com/HansPinckaers/GrowingTextView" target="_blank" rel="external">GrowingTextView</a></td>
<td>随文字改变高度的的 textView，用于本项目中的聊天输入框；</td>
</tr>
<tr>
<td><a href="https://github.com/TTTAttributedLabel/TTTAttributedLabel" target="_blank" rel="external">TTTAttributedLabel</a></td>
<td>支持多种效果的 Lable，用于本项目中的聊天气泡的文字 Label；</td>
</tr>
<tr>
<td><a href="https://github.com/wimagguc/ios-custom-alertview" target="_blank" rel="external">CustomIOSAlertView</a></td>
<td>自定义的 AlertView，用于显示本项目的评价弹出框；<strong>注意</strong>，我们队该开源项目进行了修改，增加了按钮之间的分隔线条和判断当前是否已经有 AlertView 在显示，该修改版本可以见 <a href="https://github.com/ijinmao/ios-custom-alertview" target="_blank" rel="external">CustomIOSAlertView</a>；</td>
</tr>
</tbody>
</table>
<h2 id="Hope_to_Help_Each_Other_-_互助">Hope to Help Each Other - 互助</h2><p>由于开发进度紧张，该项目写的较快，肯定有很多地方没有考虑周到，欢迎开发者指正和建议~</p>
<p>如果该 Library 有帮助到你，或是你想完善此 Library，欢迎通过任何形式联系我们，一起讨论、一起互帮互助总是好的^.^</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-信鸽推送" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/01/29/信鸽推送/" class="article-date">
  	<time datetime="2016-01-29T00:42:25.000Z" itemprop="datePublished">2016-01-29</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/01/29/信鸽推送/">信鸽推送</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="XGPush_腾讯信鸽推送_for_Cordova">XGPush 腾讯信鸽推送 for Cordova</h1><ul>
<li>[160119] 升级 SDK</li>
<li>[151229] iOS SDK 版本更新至 2.4.5，重新规划 SDK 存储路径</li>
<li>[151015] 庆祝 20 Stars，SDK 升级</li>
</ul>
<table>
<thead>
<tr>
<th>SDK</th>
<th>version</th>
</tr>
</thead>
<tbody>
<tr>
<td>android</td>
<td>Xg-Push-SDK-Android-2.42</td>
</tr>
<tr>
<td>ios</td>
<td>Xg-Push-SDK-iOS-2.4.6</td>
</tr>
</tbody>
</table>
<p>腾讯信鸽推送服务：<a href="http://xg.qq.com/" target="_blank" rel="external">http://xg.qq.com/</a></p>
<p>Cordova 版本：3.x / 4.x / 5.x</p>
<p>这个插件支持通知与消息，同时针对混合应用的生命周期进行了处理，保证消息的抵达。</p>
<h2 id="安装方法">安装方法</h2><p>打开控制台，进入 Cordova 项目目录，输入：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cordova plugin add https://github.com/ETENG-OSP/xgpush-cordova --save \</span><br><span class="line">  --variable ACCESS_ID=<span class="string">"Your Access ID"</span> \</span><br><span class="line">  --variable ACCESS_KEY=<span class="string">"Your Access Key"</span></span><br></pre></td></tr></table></figure>
<h2 id="使用方法">使用方法</h2><p>安装完成即可接收推送通知。这种用法适合于仅需要偶尔向全部用户发信息的情况。</p>
<p>如果需要精确控制，参考以下 API 和事件。</p>
<h3 id="API">API</h3><ul>
<li><p><strong>xgpush.registerPush([alias])</strong>: 注册设备</p>
<p>这个方法可以手动注册设备。如果需要为接收推送的设备取别名以便有针对性的通知，需要在 <code>deviceready</code> 后注册别名：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这里的别名是可选的，不传代表没用别名</span></span><br><span class="line">xgpush.registerPush(<span class="string">'tom'</span>);</span><br></pre></td></tr></table></figure>
<p>如果需要结果，可以用 Promise 的形式获取：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">xgpush.registerPush(<span class="string">'tom'</span>).then(<span class="function"><span class="keyword">function</span>(<span class="params">results</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// results 里有 flag 和 data</span></span><br><span class="line">  alert(<span class="string">'设备的 token 是: '</span> + results.data);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>可以重复注册，下一个别名会替换上一个别名。</p>
</li>
<li><p><strong>xgpush.unregisterPush()</strong>: 注销设备</p>
<p>如果不想接收推送，使用 <code>xgpush.unregisterPush</code>：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xgpush.unregisterPush()</span><br></pre></td></tr></table></figure>
<p>这个方法也返回 Promise。</p>
</li>
</ul>
<h3 id="事件">事件</h3><ul>
<li><strong>textmessage</strong>: 文本消息</li>
</ul>
<p>如果需要接受消息，直接在代码里处理，可以监听 <code>textmessage</code> 事件：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">xgpush.on(<span class="string">'textmessage'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 事件处理方法</span></span><br><span class="line">  alert(<span class="built_in">JSON</span>.stringify(<span class="built_in">arguments</span>, <span class="literal">null</span>, <span class="number">2</span>));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>事件采用了与 Node.js 事件兼容的 eventemitter3。具体方法参考：<a href="https://nodejs.org/api/events.html" target="_blank" rel="external">https://nodejs.org/api/events.html</a></p>
<h2 id="用例">用例</h2><p>如果需要推送一条信息，用户在点击该信息后进入应用，同时触发程序逻辑。可以发送一个带有自定义 URL scheme 的通知。</p>
<p>参考这个插件：<a href="https://github.com/EddyVerbruggen/Custom-URL-scheme" target="_blank" rel="external">https://github.com/EddyVerbruggen/Custom-URL-scheme</a></p>
<h2 id="注意事项">注意事项</h2><h3 id="armv7s_与_xcode_6">armv7s 与 xcode 6</h3><p>如果执行 <code>cordova build --device --release</code> 不成功，请去掉 <code>build.js</code> 里的 armv7s。</p>
<p>参考：<br><a href="https://issues.apache.org/jira/browse/CB-8788" target="_blank" rel="external">https://issues.apache.org/jira/browse/CB-8788</a></p>
<h3 id="不同平台_so_文件">不同平台 so 文件</h3><p>这个插件内置了 armeabi 的库文件。如果目标平台不是 armeabi，请到 <a href="http://xg.qq.com/xg/help/ctr_help/download" target="_blank" rel="external">http://xg.qq.com/xg/help/ctr_help/download</a> 下载对应版本的 SDK。</p>
<p>以下引用 SDK 中的说明：</p>
<blockquote>
<ol>
<li><p>信鸽的 .so 支持所有的 android 平台，但考虑到平时接入一般只需要 armeabi 平台，因此 libs 目录只提供该平台的 .so，其它平台可在上层目录的 All-Platform-SO 找到。</p>
</li>
<li><p>嵌入 .so 可能存在的问题：</p>
<ol>
<li><p>so 文件与 jar 包不匹配。</p>
<p>解决办法：在更新 jar 时同时更新对应的 so 文件；</p>
</li>
<li><p>当前工程已有某些平台的 so，如只有 armeabi 平台，却添加信鸽所有平台导致打包时异常。</p>
<p>解决办法：只添加当前工程已有的平台的信鸽 so 文件。具体可参考网上或以下示例：</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&gt;     armeabi	   ！此平台既有当前存在so又有信鸽，正常！</span><br><span class="line">&gt;       <span class="comment">--libCurrent.so			当前工程已有so</span></span><br><span class="line">&gt;       <span class="comment">--libtpnsSecurity.so	信鸽</span></span><br><span class="line">&gt;       <span class="comment">--libtpnsWatchdog.so	信鸽</span></span><br><span class="line">&gt;</span><br><span class="line">&gt;     armeabi-v7a	！此平台既有当前存在so又有信鸽，正常！</span><br><span class="line">&gt;       <span class="comment">--libCurrent.so			当前工程已有so</span></span><br><span class="line">&gt;       <span class="comment">--libtpnsSecurity.so	信鸽</span></span><br><span class="line">&gt;       <span class="comment">--libtpnsWatchdog.so	信鸽</span></span><br><span class="line">&gt;</span><br><span class="line">&gt;     mips	！！！错误，由于此平台只有信鸽，必须删掉mips目录！！！</span><br><span class="line">&gt;       <span class="comment">--libtpnsSecurity.so	信鸽</span></span><br><span class="line">&gt;       <span class="comment">--libtpnsWatchdog.so	信鸽</span></span><br><span class="line">&gt;</span><br><span class="line">&gt;     x86		！！！错误，由于此平台只有信鸽，必须删掉x86目录！！！</span><br><span class="line">&gt;       <span class="comment">--libtpnsSecurity.so	信鸽</span></span><br><span class="line">&gt;       <span class="comment">--libtpnsWatchdog.so	信鸽</span></span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
</ol>
</blockquote>
<p>&gt;</p>
<blockquote>
<ol>
<li><p>若当前工程不存在 so 文件。</p>
<p>解决办法：可复制所有信鸽平台或只复制 armeabi 平台。</p>
</li>
</ol>
</blockquote>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-模仿微信" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/01/27/模仿微信/" class="article-date">
  	<time datetime="2016-01-27T04:50:16.000Z" itemprop="datePublished">2016-01-27</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/01/27/模仿微信/">模仿微信</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="https://github.com/xhzengAIB/LearnEnglish/raw/master/Screenshots/MessageDisplayKit.png" alt=""></p>
<h1 id="MessageDisplayKit">MessageDisplayKit</h1><p>一个类似微信App的IM应用，拥有发送文字、图片、语音、视频、地理位置消息，管理本地通信录、分享朋友圈、漂流交友、摇一摇和更多有趣的功能。<br>An IM APP like WeChat which has sending text, pictures, audio, video, location messaging, managing local address book, share moments with friends, drift bottle, shake for new friends and some other interesting features.<br><img src="https://github.com/xhzengAIB/LearnEnglish/raw/master/Screenshots/MessageDisplayKit.gif" alt="image"></p>
<h2 id="宝贵意见">宝贵意见</h2><p>如果有任何问题，请到github开issue，<a href="https://github.com/xhzengAIB/MessageDisplayKit/issues?state=open" target="_blank" rel="external">点击这里</a>移步新建一个issue，写上你不明白的地方，我会在github给予帮助。                        </p>
<p>很多朋友反应，只看到静态库，看不到源码，一个工作区域内，有多个使用例子，也包含了源码，源码请<a href="https://github.com/xhzengAIB/MessageDisplayKit/tree/master/MessageDisplayKit" target="_blank" rel="external">戳这里</a>, 让大家都可以快速查看到。</p>
<p>Most of code has comments with which I believe you can understand them. If you can’t understand the code please feel free to [open an issue] (<a href="https://github.com/xhzengAIB/MessageDisplayKit/issues?state=open" target="_blank" rel="external">https://github.com/xhzengAIB/MessageDisplayKit/issues?state=open</a>) I will do my best to answer them.</p>
<h2 id="非常有趣，在LeanClound的开发者支持下，将开始全面的改进，将没有实现业务的功能进行对接LC的后台，敬请期待哦！">非常有趣，在LeanClound的开发者支持下，将开始全面的改进，将没有实现业务的功能进行对接LC的后台，敬请期待哦！</h2><h2 id="组件要求_Requirements">组件要求                                        Requirements</h2><ul>
<li>iPhone4/5/6/6+/iPad，Portrait</li>
<li>Xcode6 or later</li>
<li>iOS 6.0+ </li>
<li>ARC</li>
<li>System Frameworks : ‘Foundation’, ‘CoreGraphics’, ‘UIKit’, ‘MobileCoreServices’, ‘AVFoundation’, ‘CoreLocation’, ‘MediaPlayer’, ‘CoreMedia’, ‘CoreText’, ‘AudioToolbox’.</li>
</ul>
<h2 id="Podfile">Podfile</h2><p><a href="http://cocoapods.org/" target="_blank" rel="external">CocoaPods</a> is the recommended method to install MessageDisplayKit, just add the following line to <code>Podfile</code></p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">pod</span> <span class="string">'MessageDisplayKit'</span></span><br></pre></td></tr></table></figure>
<p>and run <code>pod install</code>, then you’re all done!</p>
<h2 id="TODO">TODO</h2><ul>
<li>尽量去除绘制代码，由于现在引起性能下降的原因之一。<br>Delete drawRect code, because of lead to lower FPS. </li>
<li>语音转换处理，适应多平台可用语音、视频等数据。<br>Convert audio format.</li>
<li>搭建服务器。<br>Build server </li>
<li>模仿微信全部功能。</li>
</ul>
<h2 id="特性_Features">特性 Features</h2><ul>
<li>1、高度可定制。<br>Highly customizable.                           </li>
<li>2、任意消息的大小。<br>Arbitrary message sizes.                           </li>
<li>3、复制&amp;粘贴消息。<br>Able to copy &amp; paste messages.                           </li>
<li>4、数据检查器(确认电话号码、链接、日期等)。<br>Data detectors (recognizes phone numbers, links, dates, etc.).                           </li>
<li>5、时间戳。<br>Timestamps.                           </li>
<li>6、头像。<br>Avatars.                           </li>
<li>7、向下滑动隐藏键盘。<br>Swipe down to hide keyboard.                           </li>
<li>8、动态调整输入文本视图类型。<br>Dynamically resize input text view as you type.                           </li>
<li>9、自动启用/禁用发送按钮(如果文本视图是空的或不是)。<br>Automatically enable/disable send button according to the content of text view.                           </li>
<li>10、发送/接收声音效果。<br>Send/Receive sound effects.                           </li>
<li>11、发送语音。<br>Send voice messages.                           </li>
<li>12、发送图片。<br>Send photos.                           </li>
<li>13、发送视频。<br>Send videos.                           </li>
<li>14、发送地理位置。<br>Send geolocations.                           </li>
<li>15、发送第三方gif表情。<br>Send third party gif message.                           </li>
<li>16、通用于iPhone和iPad。<br>Support both iPhone and iPad.                            </li>
<li>17、支持StoryBorad。<br>Support the StoryBorad to user.                              </li>
<li>18、支持下拉加载更多旧消息，处理了保持可见cell不滚动的效果。<br>Support pull down load more old message, keep visible cells static when inserting old message at top.</li>
<li>19、支持通信录</li>
<li>20、支持朋友圈</li>
<li>21、支持扫一扫</li>
<li>22、支持摇一摇</li>
<li>23、支持附近的人</li>
<li>24、支持漂流瓶</li>
<li>25、支持多选联系人</li>
<li>26、支持新闻模板嵌套</li>
<li>27、支持弹出Menu菜单</li>
<li>28、支持游戏室展示</li>
<li>29、支持表情商店预览</li>
<li>30、核心网络层。<br>Core Network Layer.                                                          </li>
<li>31、核心缓存层。<br>Core Cache Layer.                                                    </li>
<li>32、核心数据层。<br>Core Model Layer.                      </li>
<li>33、优化TableView性能<br>Majorization tableView performance.                        </li>
<li>34、强化gif播放机制<br>Keep FPS due wih gif play.                      </li>
</ul>
<h2 id="How_to_use">How to use</h2><p>Easy to drop into your project.                                </p>
<ul>
<li><p>1、#import “XHMessageTableViewController.h”                                </p>
</li>
<li><p>2、Your must be subClass XHMessageTableViewController.                                </p>
</li>
<li><p>3、implementation XHMessageTableViewController delegate due with message send.                                </p>
</li>
<li><p>4、implementation XHMessageTableViewController DataSource due with message source.                                </p>
</li>
<li><p>5、If you went to emotion message / plug function / audio play, must be implementation other delegate or dataSource.                                                                   </p>
</li>
<li>Detail look this <a href="https://github.com/xhzengAIB/MessageDisplayKit/blob/master/Example/MessageDisplayExample/MessageDisplayExample/XHDemoWeChatMessageTableViewController.m" target="_blank" rel="external">demo</a>.                           </li>
</ul>
<h2 id="License">License</h2><p>中文: MessageDisplayKit 是在MIT协议下使用的，可以在LICENSE文件里面找到相关的使用协议信息。</p>
<p>English: MessageDisplayKit is available under the MIT license, see the LICENSE file for more information.     </p>
<h2 id="须知_Notes">须知       Notes</h2><p>如果您在您的项目中使用该开源组件，请给我们发<a href="mailto:xhzengAIB@gmail.com?subject=From%20GitHub%20MessageDisplayKit" target="_blank" rel="external">电子邮件</a>告诉我们您的应用程序的名称，谢谢！主要是为了互推的效果，如果您的app火了，请给予少许的回报，如果您的App不火，或许能通过这个开源库了解到您的App！<br>主要目的只有一个，互推，使用该开源库的开发者，我都会向其保证，永远免费，不涉及任何商业纠纷的事情，请放心使用。</p>
<p>If you use this open source components in your project, please <a href="mailto:xhzengAIB@gmail.com?subject=From%20GitHub%20MessageDisplayKit" target="_blank" rel="external">Email us</a> to notify us the name of your application(s). Thanks!</p>
<h2 id="What_app_use_this_open_source">What app use this open source</h2><p>这里会列出所有使用该开源库的App列表。<br><a href="https://github.com/leancloud/leanchat-ios" target="_blank" rel="external">leanchat-ios</a>，LeanCloud 提供一站式后端云服务，从数据存储、实时聊天、消息推送到移动统计，涵盖应用开发的多方面后端需求。<br><a href="https://itunes.apple.com/cn/app/jia-xin-dao-gou-yuan/id918014453?mt=8" target="_blank" rel="external">家信-导购员</a>家信，专属家居导购员的商务沟通APP。家信app，将家居消费者与离他最近的导购员及时对接。消费者微信在线随时随地与导购员接触沟通；导购员家信在线时时处处为消费者提供各种资讯、商品、咨询、导购服务，辅助消费者决策，促进消费购买，提升服务体验。</p>
<h2 id="使用到的第三方组件">使用到的第三方组件</h2><ul>
<li><a href="https://github.com/JackTeam/PathCover" target="_blank" rel="external">PathCover</a>用于朋友圈的下拉刷新。</li>
<li><a href="https://github.com/JackTeam/XHImageViewer" target="_blank" rel="external">XHImageViewer</a>图片查看器，用于整个项目。</li>
<li><a href="https://github.com/xhzengAIB/XHRefreshControl" target="_blank" rel="external">XHRefreshControl</a>是一款高扩展性、低耦合度的下拉刷新、上提加载更多的组件。用于整个项目的所有下拉刷新和上提加载更多的UI和业务逻辑。    </li>
<li></li>
<li>谢谢<a href="https://github.com/molon" target="_blank" rel="external">molon</a>提供多选组件<a href="https://github.com/molon/MLMultiSelectViewController" target="_blank" rel="external">MLMultiSelectViewController</a>，现在已经集成进去了。可用于群聊、添加多个朋友、等等。</li>
<li>Thanks you <a href="https://github.com/lakesoft" target="_blank" rel="external">lakesoft</a> provide <a href="https://github.com/lakesoft/LKBadgeView" target="_blank" rel="external">LKBadgeView</a>.</li>
<li>Thanks you <a href="https://github.com/kishikawakatsumi" target="_blank" rel="external">kishikawakatsumi</a> provide <a href="https://github.com/kishikawakatsumi/SECoreTextView" target="_blank" rel="external">SECoreTextView</a>.     </li>
</ul>
<h2 id="Thanks_Developer">Thanks Developer</h2><p><a href="https://itunes.apple.com/us/app/wo-jia-jia-ting-quan-si-mi/id538285014?mt=8" target="_blank" rel="external">我家App</a>的主程Aevit提供了技术支持，他的<a href="https://github.com/Aevit" target="_blank" rel="external">github</a>地址，点击<a href="https://itunes.apple.com/us/app/wo-jia-jia-ting-quan-si-mi/id538285014?mt=8" target="_blank" rel="external">我家App</a>下载安装，如果看到里面有好的效果，可以协商开源。                       </p>
<p>谢谢<a href="https://itunes.apple.com/cn/app/wei-xin/id414478124?mt=8" target="_blank" rel="external">微信App</a>给予我鼓励，我参考了很多框架设计问题、也提供了许多素材，但是请网友不要直接使用素材，我不知道是否会引起侵权的问题，所以请自重，我这里只是模仿微信，而不是攻击。使用该开源库所导致的所有侵权关系与我无关，我只是提供学习机会。不是原创只是分享一些好的项目。                                         </p>
<h2 id="警告">警告</h2><p>请不要拿该工程的微信图片资源文件用于商业使用，如果不遵守规则，而产生的法律责任，一律与我无关。代码按照上文描述的License和Notes来使用。                              </p>
<h2 id="Credits">Credits</h2><p>Thanks to <a href="https://github.com/jessesquires" target="_blank" rel="external">jessesquires</a> who created <a href="https://github.com/jessesquires/MessagesTableViewController" target="_blank" rel="external">JSMessagesViewController</a> on which my chat list UI work is based.                             </p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-便捷开发的小插件" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/01/23/便捷开发的小插件/" class="article-date">
  	<time datetime="2016-01-23T01:43:25.000Z" itemprop="datePublished">2016-01-23</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/01/23/便捷开发的小插件/">便捷开发的小插件</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="ColorSenseRainbow">ColorSenseRainbow</h1><p>A plugin for Xcode that shows colours and allows you to modify them.  It works for both UIColor and NSColor in Swift and Objective-C.</p>
<p>When you place the caret over some code that declares a colour in Xcode then the code will be framed and a small rectangle will appear right above the text aligned to the right displaying that colour.  This allows you to view the colour.  I don’t know about you but, except for some easy cases, I can’t tell what a colour is by looking at the numbers.  For example the following leaves me baffled:</p>
<pre><code>UIColor( red: <span class="number">143.0</span>/<span class="number">255</span>, green: <span class="number">87.0</span>/<span class="number">255.0</span>, blue: <span class="number">233.0</span>/<span class="number">255.0</span>, alpha: <span class="number">1.0</span> )
</code></pre><p>But with the plugin it becomes:</p>
<p><img src="CSR_Demo.png" alt="Demo of the plugin"></p>
<p>If you click on the color then a color picker is displayed.  As you choose colours the code is updated.  One thing to note is if you select a predefined colour and start changing the colour then the code gets changed to RGB values.  In the other cases I’ve tried to keep it as non-destructive as possible though at times the number of decimal places can change.  When the alpha isn’t specified (it isn’t required as part of the Rainbow library as I set it to a default value of 1.0) then the plugin doesn’t add the alpha component to the code.  As of May 29, 2015 the plugin will now add the alpha component for you in Swift if you change the value in the colour picker.</p>
<p>This project was inspired from <a href="https://github.com/omz/ColorSense-for-Xcode" target="_blank" rel="external">Color Sense for Xcode</a>.  In fact it looks (and I think it behaves mostly) like it.  But I built it completely from scratch in Swift though I did use that project as a template for some items as I haven’t done anything on the Mac side before.  </p>
<h1 id="Installing">Installing</h1><p>There are three ways to install the plugin.</p>
<ol>
<li>Download the code and build it.  Xcode will install the plugin in the right directory.  Restart Xcode.</li>
<li>Download the plugin and place it in the ~/Library/Application Support/Developer/Shared/Xcode/Plug-ins directory.  Restart Xcode.</li>
<li>Use the plugin <a href="http://alcatraz.io" target="_blank" rel="external">Alcatraz</a> to install and then restart Xcode.</li>
</ol>
<h1 id="Why_rewrite?">Why rewrite?</h1><p>I was having problems extending it to use my <a href="https://github.com/NorthernRealities/Rainbow" target="_blank" rel="external">Rainbow</a> and <a href="https://github.com/NorthernRealities/Rainbow-Creator" target="_blank" rel="external">Rainbow Creator</a> libraries.  I just figured that by the time that I learned how the plugin worked to extend it I had learned enough to rebuild it.  There were a few design decisions that I didn’t agree with.  Not saying that they were wrong, they are just different than what I chose in my version.  </p>
<p>I’m very thankful to Ole Zorn for the original version and all those who worked on it after.  I couldn’t have written my version with theirs.  I didn’t know about plugins, color wells, or a number of other things that I learned while writing this.  </p>
<h1 id="Extending">Extending</h1><p>I’ve tried to make the code very modular and extensible.  I’ll walk through two examples on how to expand the functionality.  Colours are found using a series of regular expressions.  Each one was kept as simple as possible to do a specific task.  I created a number of simple searches instead of having a few overly complex ones.  For example I could have had one regular expression that handled specifying float values (0.0-1.0), calculated values (45/255), and integer values (45) with the alpha being optional. Instead I made it into six regular expressions stored in three Seeker subclasses.  I felt that this decision greatly reduced the work when it came time to replace the code for new colors (the Builder classes) and improves readability.</p>
<p>When adding a new method of colour creation to be illustrated you should see if it is similar to something that the plugin already does.  Similarity would be creating a colour with the same parameters.</p>
<p>At the moment the Rainbow Creator library only works in Swift.  In there is a extension to UIColor and NSColor that allows you to create colours without having to divide integer values by 255.0.  If I were to implement the library in Objective-C then I would also need to update this plugin.  Because the Objective-C code using the library would be so similar to the Swift code the best place for me to update this plugin would be RainbowIntSeeker class.  All that needs to be done in this case is to create the new regular expressions and test.  </p>
<p>The classes that replace the code with the new color information parse the string and change the values instead of creating brand new code from scratch.  This has the benefit of keeping any formatting the user has put in (I like extra space) and it saves from having to write a bunch of if statements to check if the language is Swift or Objective-C and if the colour is a NSColor or an UIColor.  The disadvantage is that there are some functions that still use NSRange and may cause problems when used with text containing extended characters such as emoticons.</p>
<p>Assuming that you want to extend the plugin and it isn’t for something simple like the above then you are going to need to a bit more work.  But hopefully not too much.  The following are the steps I would take to add the handling of the creation of colours using hue, saturation, and brightness (HSB).  When overriding a function metioned below take a look at the other classes as a template.  They all follow a similar pattern.</p>
<ul>
<li>Add a value to the CSRColorCreationType in the SearchResult class</li>
<li>Create a new Seeker subclass</li>
<li>Override the init method to define the regular expressions needed</li>
<li>Override the processMatch method to store values when a match is made and create the color. Remember to change the creation type of the search result to the value you made in the first step. (While you would create the color with HSB values you would want to get a copy of the color in the RGB colorspace as later on the plugin assumes the color is in that colorspace.  It <strong>will crash</strong> if you don’t do this!)</li>
<li>Add the new Seeker subclass object to the array found in ColorFinder.  It’s probably best to do this at the end for performance reasons.  The most common ways to define colours should be at the front so they are found first reducing the amount of searching to be done.</li>
<li>Create a new subclass of ColorBuilder</li>
<li>Override the function stringForColor</li>
<li>Add the new ColorBuilder subclass in the switch statement in the ColorBuilderFactory.</li>
</ul>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
  
    <nav id="page-nav">
      <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
    </nav>
  
</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2016 杨晓龙
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js" type="text/javascript"></script>
<script src="/js/main.js" type="text/javascript"></script>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  </div>
</body>
</html>